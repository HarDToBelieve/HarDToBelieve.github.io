<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>vad_filterbank.c source code [webkit/Source/ThirdParty/libwebrtc/Source/webrtc/common_audio/vad/vad_filterbank.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../../../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../../../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../../../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../../../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'webkit/Source/ThirdParty/libwebrtc/Source/webrtc/common_audio/vad/vad_filterbank.c'; var root_path = '../../../../../../../..'; var data_path = '../../../../../../../../../data'; var ecma_script_api_version = 2;</script>
<script src='../../../../../../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../../../../..'>webkit</a>/<a href='../../../../../..'>Source</a>/<a href='../../../../..'>ThirdParty</a>/<a href='../../../..'>libwebrtc</a>/<a href='../../..'>Source</a>/<a href='../..'>webrtc</a>/<a href='..'>common_audio</a>/<a href='./'>vad</a>/<a href='vad_filterbank.c.html'>vad_filterbank.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> *  Copyright (c) 2012 The WebRTC project authors. All Rights Reserved.</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> *  Use of this source code is governed by a BSD-style license</i></td></tr>
<tr><th id="5">5</th><td><i> *  that can be found in the LICENSE file in the root of the source</i></td></tr>
<tr><th id="6">6</th><td><i> *  tree. An additional intellectual property rights grant can be found</i></td></tr>
<tr><th id="7">7</th><td><i> *  in the file PATENTS.  All contributing project authors may</i></td></tr>
<tr><th id="8">8</th><td><i> *  be found in the AUTHORS file in the root of the source tree.</i></td></tr>
<tr><th id="9">9</th><td><i> */</i></td></tr>
<tr><th id="10">10</th><td></td></tr>
<tr><th id="11">11</th><td><u>#include <a href="vad_filterbank.h.html">"common_audio/vad/vad_filterbank.h"</a></u></td></tr>
<tr><th id="12">12</th><td></td></tr>
<tr><th id="13">13</th><td><u>#include <a href="../../rtc_base/checks.h.html">"rtc_base/checks.h"</a></u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="../signal_processing/include/signal_processing_library.h.html">"common_audio/signal_processing/include/signal_processing_library.h"</a></u></td></tr>
<tr><th id="15">15</th><td></td></tr>
<tr><th id="16">16</th><td><i  data-doc="kLogConst">// Constants used in LogOfEnergy().</i></td></tr>
<tr><th id="17">17</th><td><em>static</em> <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="tu decl def" id="kLogConst" title='kLogConst' data-type='const int16_t' data-ref="kLogConst" data-ref-filename="kLogConst">kLogConst</dfn> = <var>24660</var>;  <i  data-doc="kLogConst">// 160*log10(2) in Q9.</i></td></tr>
<tr><th id="18">18</th><td><em>static</em> <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="tu decl def" id="kLogEnergyIntPart" title='kLogEnergyIntPart' data-type='const int16_t' data-ref="kLogEnergyIntPart" data-ref-filename="kLogEnergyIntPart">kLogEnergyIntPart</dfn> = <var>14336</var>;  <i  data-doc="kLogEnergyIntPart">// 14 in Q10</i></td></tr>
<tr><th id="19">19</th><td></td></tr>
<tr><th id="20">20</th><td><i  data-doc="kHpZeroCoefs">// Coefficients used by HighPassFilter, Q14.</i></td></tr>
<tr><th id="21">21</th><td><em>static</em> <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="tu decl def" id="kHpZeroCoefs" title='kHpZeroCoefs' data-type='const int16_t [3]' data-ref="kHpZeroCoefs" data-ref-filename="kHpZeroCoefs">kHpZeroCoefs</dfn>[<var>3</var>] = { <var>6631</var>, -<var>13262</var>, <var>6631</var> };</td></tr>
<tr><th id="22">22</th><td><em>static</em> <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="tu decl def" id="kHpPoleCoefs" title='kHpPoleCoefs' data-type='const int16_t [3]' data-ref="kHpPoleCoefs" data-ref-filename="kHpPoleCoefs">kHpPoleCoefs</dfn>[<var>3</var>] = { <var>16384</var>, -<var>7756</var>, <var>5620</var> };</td></tr>
<tr><th id="23">23</th><td></td></tr>
<tr><th id="24">24</th><td><i  data-doc="kAllPassCoefsQ15">// Allpass filter coefficients, upper and lower, in Q15.</i></td></tr>
<tr><th id="25">25</th><td><i  data-doc="kAllPassCoefsQ15">// Upper: 0.64, Lower: 0.17</i></td></tr>
<tr><th id="26">26</th><td><em>static</em> <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="tu decl def" id="kAllPassCoefsQ15" title='kAllPassCoefsQ15' data-type='const int16_t [2]' data-ref="kAllPassCoefsQ15" data-ref-filename="kAllPassCoefsQ15">kAllPassCoefsQ15</dfn>[<var>2</var>] = { <var>20972</var>, <var>5571</var> };</td></tr>
<tr><th id="27">27</th><td></td></tr>
<tr><th id="28">28</th><td><i  data-doc="kOffsetVector">// Adjustment for division with two in SplitFilter.</i></td></tr>
<tr><th id="29">29</th><td><em>static</em> <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="tu decl def" id="kOffsetVector" title='kOffsetVector' data-type='const int16_t [6]' data-ref="kOffsetVector" data-ref-filename="kOffsetVector">kOffsetVector</dfn>[<var>6</var>] = { <var>368</var>, <var>368</var>, <var>272</var>, <var>176</var>, <var>176</var>, <var>176</var> };</td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><i  data-doc="HighPassFilter">// High pass filtering, with a cut-off frequency at 80 Hz, if the |data_in| is</i></td></tr>
<tr><th id="32">32</th><td><i  data-doc="HighPassFilter">// sampled at 500 Hz.</i></td></tr>
<tr><th id="33">33</th><td><i  data-doc="HighPassFilter">//</i></td></tr>
<tr><th id="34">34</th><td><i  data-doc="HighPassFilter">// - data_in      [i]   : Input audio data sampled at 500 Hz.</i></td></tr>
<tr><th id="35">35</th><td><i  data-doc="HighPassFilter">// - data_length  [i]   : Length of input and output data.</i></td></tr>
<tr><th id="36">36</th><td><i  data-doc="HighPassFilter">// - filter_state [i/o] : State of the filter.</i></td></tr>
<tr><th id="37">37</th><td><i  data-doc="HighPassFilter">// - data_out     [o]   : Output audio data in the frequency interval</i></td></tr>
<tr><th id="38">38</th><td><i  data-doc="HighPassFilter">//                        80 - 250 Hz.</i></td></tr>
<tr><th id="39">39</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="HighPassFilter" title='HighPassFilter' data-type='void HighPassFilter(const int16_t * data_in, size_t data_length, int16_t * filter_state, int16_t * data_out)' data-ref="HighPassFilter" data-ref-filename="HighPassFilter">HighPassFilter</dfn>(<em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col1 decl" id="1data_in" title='data_in' data-type='const int16_t *' data-ref="1data_in" data-ref-filename="1data_in">data_in</dfn>, <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col2 decl" id="2data_length" title='data_length' data-type='size_t' data-ref="2data_length" data-ref-filename="2data_length">data_length</dfn>,</td></tr>
<tr><th id="40">40</th><td>                           <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col3 decl" id="3filter_state" title='filter_state' data-type='int16_t *' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</dfn>, <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col4 decl" id="4data_out" title='data_out' data-type='int16_t *' data-ref="4data_out" data-ref-filename="4data_out">data_out</dfn>) {</td></tr>
<tr><th id="41">41</th><td>  <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col5 decl" id="5i" title='i' data-type='size_t' data-ref="5i" data-ref-filename="5i">i</dfn>;</td></tr>
<tr><th id="42">42</th><td>  <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col6 decl" id="6in_ptr" title='in_ptr' data-type='const int16_t *' data-ref="6in_ptr" data-ref-filename="6in_ptr">in_ptr</dfn> = <a class="local col1 ref" href="#1data_in" title='data_in' data-ref="1data_in" data-ref-filename="1data_in">data_in</a>;</td></tr>
<tr><th id="43">43</th><td>  <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col7 decl" id="7out_ptr" title='out_ptr' data-type='int16_t *' data-ref="7out_ptr" data-ref-filename="7out_ptr">out_ptr</dfn> = <a class="local col4 ref" href="#4data_out" title='data_out' data-ref="4data_out" data-ref-filename="4data_out">data_out</a>;</td></tr>
<tr><th id="44">44</th><td>  <span class='typedef' title='int32_t' data-type='int' data-ref="int32_t" data-ref-filename="int32_t">int32_t</span> <dfn class="local col8 decl" id="8tmp32" title='tmp32' data-type='int32_t' data-ref="8tmp32" data-ref-filename="8tmp32">tmp32</dfn> = <var>0</var>;</td></tr>
<tr><th id="45">45</th><td></td></tr>
<tr><th id="46">46</th><td></td></tr>
<tr><th id="47">47</th><td>  <i>// The sum of the absolute values of the impulse response:</i></td></tr>
<tr><th id="48">48</th><td><i>  // The zero/pole-filter has a max amplification of a single sample of: 1.4546</i></td></tr>
<tr><th id="49">49</th><td><i>  // Impulse response: 0.4047 -0.6179 -0.0266  0.1993  0.1035  -0.0194</i></td></tr>
<tr><th id="50">50</th><td><i>  // The all-zero section has a max amplification of a single sample of: 1.6189</i></td></tr>
<tr><th id="51">51</th><td><i>  // Impulse response: 0.4047 -0.8094  0.4047  0       0        0</i></td></tr>
<tr><th id="52">52</th><td><i>  // The all-pole section has a max amplification of a single sample of: 1.9931</i></td></tr>
<tr><th id="53">53</th><td><i>  // Impulse response: 1.0000  0.4734 -0.1189 -0.2187 -0.0627   0.04532</i></td></tr>
<tr><th id="54">54</th><td></td></tr>
<tr><th id="55">55</th><td>  <b>for</b> (<a class="local col5 ref" href="#5i" title='i' data-ref="5i" data-ref-filename="5i">i</a> = <var>0</var>; <a class="local col5 ref" href="#5i" title='i' data-ref="5i" data-ref-filename="5i">i</a> &lt; <a class="local col2 ref" href="#2data_length" title='data_length' data-ref="2data_length" data-ref-filename="2data_length">data_length</a>; <a class="local col5 ref" href="#5i" title='i' data-ref="5i" data-ref-filename="5i">i</a>++) {</td></tr>
<tr><th id="56">56</th><td>    <i>// All-zero section (filter coefficients in Q14).</i></td></tr>
<tr><th id="57">57</th><td>    <a class="local col8 ref" href="#8tmp32" title='tmp32' data-ref="8tmp32" data-ref-filename="8tmp32">tmp32</a> = <a class="tu ref" href="#kHpZeroCoefs" title='kHpZeroCoefs' data-use='r' data-ref="kHpZeroCoefs" data-ref-filename="kHpZeroCoefs">kHpZeroCoefs</a>[<var>0</var>] * *<a class="local col6 ref" href="#6in_ptr" title='in_ptr' data-ref="6in_ptr" data-ref-filename="6in_ptr">in_ptr</a>;</td></tr>
<tr><th id="58">58</th><td>    <a class="local col8 ref" href="#8tmp32" title='tmp32' data-ref="8tmp32" data-ref-filename="8tmp32">tmp32</a> += <a class="tu ref" href="#kHpZeroCoefs" title='kHpZeroCoefs' data-use='r' data-ref="kHpZeroCoefs" data-ref-filename="kHpZeroCoefs">kHpZeroCoefs</a>[<var>1</var>] * <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>0</var>];</td></tr>
<tr><th id="59">59</th><td>    <a class="local col8 ref" href="#8tmp32" title='tmp32' data-ref="8tmp32" data-ref-filename="8tmp32">tmp32</a> += <a class="tu ref" href="#kHpZeroCoefs" title='kHpZeroCoefs' data-use='r' data-ref="kHpZeroCoefs" data-ref-filename="kHpZeroCoefs">kHpZeroCoefs</a>[<var>2</var>] * <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>1</var>];</td></tr>
<tr><th id="60">60</th><td>    <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>1</var>] = <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>0</var>];</td></tr>
<tr><th id="61">61</th><td>    <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>0</var>] = *<a class="local col6 ref" href="#6in_ptr" title='in_ptr' data-ref="6in_ptr" data-ref-filename="6in_ptr">in_ptr</a>++;</td></tr>
<tr><th id="62">62</th><td></td></tr>
<tr><th id="63">63</th><td>    <i>// All-pole section (filter coefficients in Q14).</i></td></tr>
<tr><th id="64">64</th><td>    <a class="local col8 ref" href="#8tmp32" title='tmp32' data-ref="8tmp32" data-ref-filename="8tmp32">tmp32</a> -= <a class="tu ref" href="#kHpPoleCoefs" title='kHpPoleCoefs' data-use='r' data-ref="kHpPoleCoefs" data-ref-filename="kHpPoleCoefs">kHpPoleCoefs</a>[<var>1</var>] * <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>2</var>];</td></tr>
<tr><th id="65">65</th><td>    <a class="local col8 ref" href="#8tmp32" title='tmp32' data-ref="8tmp32" data-ref-filename="8tmp32">tmp32</a> -= <a class="tu ref" href="#kHpPoleCoefs" title='kHpPoleCoefs' data-use='r' data-ref="kHpPoleCoefs" data-ref-filename="kHpPoleCoefs">kHpPoleCoefs</a>[<var>2</var>] * <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>3</var>];</td></tr>
<tr><th id="66">66</th><td>    <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>3</var>] = <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>2</var>];</td></tr>
<tr><th id="67">67</th><td>    <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>2</var>] = (<span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>) (<a class="local col8 ref" href="#8tmp32" title='tmp32' data-ref="8tmp32" data-ref-filename="8tmp32">tmp32</a> &gt;&gt; <var>14</var>);</td></tr>
<tr><th id="68">68</th><td>    *<a class="local col7 ref" href="#7out_ptr" title='out_ptr' data-ref="7out_ptr" data-ref-filename="7out_ptr">out_ptr</a>++ = <a class="local col3 ref" href="#3filter_state" title='filter_state' data-ref="3filter_state" data-ref-filename="3filter_state">filter_state</a>[<var>2</var>];</td></tr>
<tr><th id="69">69</th><td>  }</td></tr>
<tr><th id="70">70</th><td>}</td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td><i  data-doc="AllPassFilter">// All pass filtering of |data_in|, used before splitting the signal into two</i></td></tr>
<tr><th id="73">73</th><td><i  data-doc="AllPassFilter">// frequency bands (low pass vs high pass).</i></td></tr>
<tr><th id="74">74</th><td><i  data-doc="AllPassFilter">// Note that |data_in| and |data_out| can NOT correspond to the same address.</i></td></tr>
<tr><th id="75">75</th><td><i  data-doc="AllPassFilter">//</i></td></tr>
<tr><th id="76">76</th><td><i  data-doc="AllPassFilter">// - data_in            [i]   : Input audio signal given in Q0.</i></td></tr>
<tr><th id="77">77</th><td><i  data-doc="AllPassFilter">// - data_length        [i]   : Length of input and output data.</i></td></tr>
<tr><th id="78">78</th><td><i  data-doc="AllPassFilter">// - filter_coefficient [i]   : Given in Q15.</i></td></tr>
<tr><th id="79">79</th><td><i  data-doc="AllPassFilter">// - filter_state       [i/o] : State of the filter given in Q(-1).</i></td></tr>
<tr><th id="80">80</th><td><i  data-doc="AllPassFilter">// - data_out           [o]   : Output audio signal given in Q(-1).</i></td></tr>
<tr><th id="81">81</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="AllPassFilter" title='AllPassFilter' data-type='void AllPassFilter(const int16_t * data_in, size_t data_length, int16_t filter_coefficient, int16_t * filter_state, int16_t * data_out)' data-ref="AllPassFilter" data-ref-filename="AllPassFilter">AllPassFilter</dfn>(<em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col9 decl" id="9data_in" title='data_in' data-type='const int16_t *' data-ref="9data_in" data-ref-filename="9data_in">data_in</dfn>, <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col0 decl" id="10data_length" title='data_length' data-type='size_t' data-ref="10data_length" data-ref-filename="10data_length">data_length</dfn>,</td></tr>
<tr><th id="82">82</th><td>                          <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="local col1 decl" id="11filter_coefficient" title='filter_coefficient' data-type='int16_t' data-ref="11filter_coefficient" data-ref-filename="11filter_coefficient">filter_coefficient</dfn>, <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col2 decl" id="12filter_state" title='filter_state' data-type='int16_t *' data-ref="12filter_state" data-ref-filename="12filter_state">filter_state</dfn>,</td></tr>
<tr><th id="83">83</th><td>                          <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col3 decl" id="13data_out" title='data_out' data-type='int16_t *' data-ref="13data_out" data-ref-filename="13data_out">data_out</dfn>) {</td></tr>
<tr><th id="84">84</th><td>  <i>// The filter can only cause overflow (in the w16 output variable)</i></td></tr>
<tr><th id="85">85</th><td><i>  // if more than 4 consecutive input numbers are of maximum value and</i></td></tr>
<tr><th id="86">86</th><td><i>  // has the the same sign as the impulse responses first taps.</i></td></tr>
<tr><th id="87">87</th><td><i>  // First 6 taps of the impulse response:</i></td></tr>
<tr><th id="88">88</th><td><i>  // 0.6399 0.5905 -0.3779 0.2418 -0.1547 0.0990</i></td></tr>
<tr><th id="89">89</th><td></td></tr>
<tr><th id="90">90</th><td>  <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col4 decl" id="14i" title='i' data-type='size_t' data-ref="14i" data-ref-filename="14i">i</dfn>;</td></tr>
<tr><th id="91">91</th><td>  <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="local col5 decl" id="15tmp16" title='tmp16' data-type='int16_t' data-ref="15tmp16" data-ref-filename="15tmp16">tmp16</dfn> = <var>0</var>;</td></tr>
<tr><th id="92">92</th><td>  <span class='typedef' title='int32_t' data-type='int' data-ref="int32_t" data-ref-filename="int32_t">int32_t</span> <dfn class="local col6 decl" id="16tmp32" title='tmp32' data-type='int32_t' data-ref="16tmp32" data-ref-filename="16tmp32">tmp32</dfn> = <var>0</var>;</td></tr>
<tr><th id="93">93</th><td>  <span class='typedef' title='int32_t' data-type='int' data-ref="int32_t" data-ref-filename="int32_t">int32_t</span> <dfn class="local col7 decl" id="17state32" title='state32' data-type='int32_t' data-ref="17state32" data-ref-filename="17state32">state32</dfn> = ((<span class='typedef' title='int32_t' data-type='int' data-ref="int32_t" data-ref-filename="int32_t">int32_t</span>) (*<a class="local col2 ref" href="#12filter_state" title='filter_state' data-ref="12filter_state" data-ref-filename="12filter_state">filter_state</a>) * (<var>1</var> &lt;&lt; <var>16</var>));  <i>// Q15</i></td></tr>
<tr><th id="94">94</th><td></td></tr>
<tr><th id="95">95</th><td>  <b>for</b> (<a class="local col4 ref" href="#14i" title='i' data-ref="14i" data-ref-filename="14i">i</a> = <var>0</var>; <a class="local col4 ref" href="#14i" title='i' data-ref="14i" data-ref-filename="14i">i</a> &lt; <a class="local col0 ref" href="#10data_length" title='data_length' data-ref="10data_length" data-ref-filename="10data_length">data_length</a>; <a class="local col4 ref" href="#14i" title='i' data-ref="14i" data-ref-filename="14i">i</a>++) {</td></tr>
<tr><th id="96">96</th><td>    <a class="local col6 ref" href="#16tmp32" title='tmp32' data-ref="16tmp32" data-ref-filename="16tmp32">tmp32</a> = <a class="local col7 ref" href="#17state32" title='state32' data-ref="17state32" data-ref-filename="17state32">state32</a> + <a class="local col1 ref" href="#11filter_coefficient" title='filter_coefficient' data-ref="11filter_coefficient" data-ref-filename="11filter_coefficient">filter_coefficient</a> * *<a class="local col9 ref" href="#9data_in" title='data_in' data-ref="9data_in" data-ref-filename="9data_in">data_in</a>;</td></tr>
<tr><th id="97">97</th><td>    <a class="local col5 ref" href="#15tmp16" title='tmp16' data-ref="15tmp16" data-ref-filename="15tmp16">tmp16</a> = (<span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>) (<a class="local col6 ref" href="#16tmp32" title='tmp32' data-ref="16tmp32" data-ref-filename="16tmp32">tmp32</a> &gt;&gt; <var>16</var>);  <i>// Q(-1)</i></td></tr>
<tr><th id="98">98</th><td>    *<a class="local col3 ref" href="#13data_out" title='data_out' data-ref="13data_out" data-ref-filename="13data_out">data_out</a>++ = <a class="local col5 ref" href="#15tmp16" title='tmp16' data-ref="15tmp16" data-ref-filename="15tmp16">tmp16</a>;</td></tr>
<tr><th id="99">99</th><td>    <a class="local col7 ref" href="#17state32" title='state32' data-ref="17state32" data-ref-filename="17state32">state32</a> = (*<a class="local col9 ref" href="#9data_in" title='data_in' data-ref="9data_in" data-ref-filename="9data_in">data_in</a> * (<var>1</var> &lt;&lt; <var>14</var>)) - <a class="local col1 ref" href="#11filter_coefficient" title='filter_coefficient' data-ref="11filter_coefficient" data-ref-filename="11filter_coefficient">filter_coefficient</a> * <a class="local col5 ref" href="#15tmp16" title='tmp16' data-ref="15tmp16" data-ref-filename="15tmp16">tmp16</a>;  <i>// Q14</i></td></tr>
<tr><th id="100">100</th><td>    <a class="local col7 ref" href="#17state32" title='state32' data-ref="17state32" data-ref-filename="17state32">state32</a> *= <var>2</var>;  <i>// Q15.</i></td></tr>
<tr><th id="101">101</th><td>    <a class="local col9 ref" href="#9data_in" title='data_in' data-ref="9data_in" data-ref-filename="9data_in">data_in</a> += <var>2</var>;</td></tr>
<tr><th id="102">102</th><td>  }</td></tr>
<tr><th id="103">103</th><td></td></tr>
<tr><th id="104">104</th><td>  *<a class="local col2 ref" href="#12filter_state" title='filter_state' data-ref="12filter_state" data-ref-filename="12filter_state">filter_state</a> = (<span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>) (<a class="local col7 ref" href="#17state32" title='state32' data-ref="17state32" data-ref-filename="17state32">state32</a> &gt;&gt; <var>16</var>);  <i>// Q(-1)</i></td></tr>
<tr><th id="105">105</th><td>}</td></tr>
<tr><th id="106">106</th><td></td></tr>
<tr><th id="107">107</th><td><i  data-doc="SplitFilter">// Splits |data_in| into |hp_data_out| and |lp_data_out| corresponding to</i></td></tr>
<tr><th id="108">108</th><td><i  data-doc="SplitFilter">// an upper (high pass) part and a lower (low pass) part respectively.</i></td></tr>
<tr><th id="109">109</th><td><i  data-doc="SplitFilter">//</i></td></tr>
<tr><th id="110">110</th><td><i  data-doc="SplitFilter">// - data_in      [i]   : Input audio data to be split into two frequency bands.</i></td></tr>
<tr><th id="111">111</th><td><i  data-doc="SplitFilter">// - data_length  [i]   : Length of |data_in|.</i></td></tr>
<tr><th id="112">112</th><td><i  data-doc="SplitFilter">// - upper_state  [i/o] : State of the upper filter, given in Q(-1).</i></td></tr>
<tr><th id="113">113</th><td><i  data-doc="SplitFilter">// - lower_state  [i/o] : State of the lower filter, given in Q(-1).</i></td></tr>
<tr><th id="114">114</th><td><i  data-doc="SplitFilter">// - hp_data_out  [o]   : Output audio data of the upper half of the spectrum.</i></td></tr>
<tr><th id="115">115</th><td><i  data-doc="SplitFilter">//                        The length is |data_length| / 2.</i></td></tr>
<tr><th id="116">116</th><td><i  data-doc="SplitFilter">// - lp_data_out  [o]   : Output audio data of the lower half of the spectrum.</i></td></tr>
<tr><th id="117">117</th><td><i  data-doc="SplitFilter">//                        The length is |data_length| / 2.</i></td></tr>
<tr><th id="118">118</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="SplitFilter" title='SplitFilter' data-type='void SplitFilter(const int16_t * data_in, size_t data_length, int16_t * upper_state, int16_t * lower_state, int16_t * hp_data_out, int16_t * lp_data_out)' data-ref="SplitFilter" data-ref-filename="SplitFilter">SplitFilter</dfn>(<em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col8 decl" id="18data_in" title='data_in' data-type='const int16_t *' data-ref="18data_in" data-ref-filename="18data_in">data_in</dfn>, <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col9 decl" id="19data_length" title='data_length' data-type='size_t' data-ref="19data_length" data-ref-filename="19data_length">data_length</dfn>,</td></tr>
<tr><th id="119">119</th><td>                        <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col0 decl" id="20upper_state" title='upper_state' data-type='int16_t *' data-ref="20upper_state" data-ref-filename="20upper_state">upper_state</dfn>, <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col1 decl" id="21lower_state" title='lower_state' data-type='int16_t *' data-ref="21lower_state" data-ref-filename="21lower_state">lower_state</dfn>,</td></tr>
<tr><th id="120">120</th><td>                        <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col2 decl" id="22hp_data_out" title='hp_data_out' data-type='int16_t *' data-ref="22hp_data_out" data-ref-filename="22hp_data_out">hp_data_out</dfn>, <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col3 decl" id="23lp_data_out" title='lp_data_out' data-type='int16_t *' data-ref="23lp_data_out" data-ref-filename="23lp_data_out">lp_data_out</dfn>) {</td></tr>
<tr><th id="121">121</th><td>  <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col4 decl" id="24i" title='i' data-type='size_t' data-ref="24i" data-ref-filename="24i">i</dfn>;</td></tr>
<tr><th id="122">122</th><td>  <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col5 decl" id="25half_length" title='half_length' data-type='size_t' data-ref="25half_length" data-ref-filename="25half_length">half_length</dfn> = <a class="local col9 ref" href="#19data_length" title='data_length' data-ref="19data_length" data-ref-filename="19data_length">data_length</a> &gt;&gt; <var>1</var>;  <i>// Downsampling by 2.</i></td></tr>
<tr><th id="123">123</th><td>  <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="local col6 decl" id="26tmp_out" title='tmp_out' data-type='int16_t' data-ref="26tmp_out" data-ref-filename="26tmp_out">tmp_out</dfn>;</td></tr>
<tr><th id="124">124</th><td></td></tr>
<tr><th id="125">125</th><td>  <i>// All-pass filtering upper branch.</i></td></tr>
<tr><th id="126">126</th><td>  <a class="tu ref fn" href="#AllPassFilter" title='AllPassFilter' data-use='c' data-ref="AllPassFilter" data-ref-filename="AllPassFilter">AllPassFilter</a>(&amp;<a class="local col8 ref" href="#18data_in" title='data_in' data-ref="18data_in" data-ref-filename="18data_in">data_in</a>[<var>0</var>], <a class="local col5 ref" href="#25half_length" title='half_length' data-ref="25half_length" data-ref-filename="25half_length">half_length</a>, <a class="tu ref" href="#kAllPassCoefsQ15" title='kAllPassCoefsQ15' data-use='r' data-ref="kAllPassCoefsQ15" data-ref-filename="kAllPassCoefsQ15">kAllPassCoefsQ15</a>[<var>0</var>], <a class="local col0 ref" href="#20upper_state" title='upper_state' data-ref="20upper_state" data-ref-filename="20upper_state">upper_state</a>,</td></tr>
<tr><th id="127">127</th><td>                <a class="local col2 ref" href="#22hp_data_out" title='hp_data_out' data-ref="22hp_data_out" data-ref-filename="22hp_data_out">hp_data_out</a>);</td></tr>
<tr><th id="128">128</th><td></td></tr>
<tr><th id="129">129</th><td>  <i>// All-pass filtering lower branch.</i></td></tr>
<tr><th id="130">130</th><td>  <a class="tu ref fn" href="#AllPassFilter" title='AllPassFilter' data-use='c' data-ref="AllPassFilter" data-ref-filename="AllPassFilter">AllPassFilter</a>(&amp;<a class="local col8 ref" href="#18data_in" title='data_in' data-ref="18data_in" data-ref-filename="18data_in">data_in</a>[<var>1</var>], <a class="local col5 ref" href="#25half_length" title='half_length' data-ref="25half_length" data-ref-filename="25half_length">half_length</a>, <a class="tu ref" href="#kAllPassCoefsQ15" title='kAllPassCoefsQ15' data-use='r' data-ref="kAllPassCoefsQ15" data-ref-filename="kAllPassCoefsQ15">kAllPassCoefsQ15</a>[<var>1</var>], <a class="local col1 ref" href="#21lower_state" title='lower_state' data-ref="21lower_state" data-ref-filename="21lower_state">lower_state</a>,</td></tr>
<tr><th id="131">131</th><td>                <a class="local col3 ref" href="#23lp_data_out" title='lp_data_out' data-ref="23lp_data_out" data-ref-filename="23lp_data_out">lp_data_out</a>);</td></tr>
<tr><th id="132">132</th><td></td></tr>
<tr><th id="133">133</th><td>  <i>// Make LP and HP signals.</i></td></tr>
<tr><th id="134">134</th><td>  <b>for</b> (<a class="local col4 ref" href="#24i" title='i' data-ref="24i" data-ref-filename="24i">i</a> = <var>0</var>; <a class="local col4 ref" href="#24i" title='i' data-ref="24i" data-ref-filename="24i">i</a> &lt; <a class="local col5 ref" href="#25half_length" title='half_length' data-ref="25half_length" data-ref-filename="25half_length">half_length</a>; <a class="local col4 ref" href="#24i" title='i' data-ref="24i" data-ref-filename="24i">i</a>++) {</td></tr>
<tr><th id="135">135</th><td>    <a class="local col6 ref" href="#26tmp_out" title='tmp_out' data-ref="26tmp_out" data-ref-filename="26tmp_out">tmp_out</a> = *<a class="local col2 ref" href="#22hp_data_out" title='hp_data_out' data-ref="22hp_data_out" data-ref-filename="22hp_data_out">hp_data_out</a>;</td></tr>
<tr><th id="136">136</th><td>    *<a class="local col2 ref" href="#22hp_data_out" title='hp_data_out' data-ref="22hp_data_out" data-ref-filename="22hp_data_out">hp_data_out</a>++ -= *<a class="local col3 ref" href="#23lp_data_out" title='lp_data_out' data-ref="23lp_data_out" data-ref-filename="23lp_data_out">lp_data_out</a>;</td></tr>
<tr><th id="137">137</th><td>    *<a class="local col3 ref" href="#23lp_data_out" title='lp_data_out' data-ref="23lp_data_out" data-ref-filename="23lp_data_out">lp_data_out</a>++ += <a class="local col6 ref" href="#26tmp_out" title='tmp_out' data-ref="26tmp_out" data-ref-filename="26tmp_out">tmp_out</a>;</td></tr>
<tr><th id="138">138</th><td>  }</td></tr>
<tr><th id="139">139</th><td>}</td></tr>
<tr><th id="140">140</th><td></td></tr>
<tr><th id="141">141</th><td><i  data-doc="LogOfEnergy">// Calculates the energy of |data_in| in dB, and also updates an overall</i></td></tr>
<tr><th id="142">142</th><td><i  data-doc="LogOfEnergy">// |total_energy| if necessary.</i></td></tr>
<tr><th id="143">143</th><td><i  data-doc="LogOfEnergy">//</i></td></tr>
<tr><th id="144">144</th><td><i  data-doc="LogOfEnergy">// - data_in      [i]   : Input audio data for energy calculation.</i></td></tr>
<tr><th id="145">145</th><td><i  data-doc="LogOfEnergy">// - data_length  [i]   : Length of input data.</i></td></tr>
<tr><th id="146">146</th><td><i  data-doc="LogOfEnergy">// - offset       [i]   : Offset value added to |log_energy|.</i></td></tr>
<tr><th id="147">147</th><td><i  data-doc="LogOfEnergy">// - total_energy [i/o] : An external energy updated with the energy of</i></td></tr>
<tr><th id="148">148</th><td><i  data-doc="LogOfEnergy">//                        |data_in|.</i></td></tr>
<tr><th id="149">149</th><td><i  data-doc="LogOfEnergy">//                        NOTE: |total_energy| is only updated if</i></td></tr>
<tr><th id="150">150</th><td><i  data-doc="LogOfEnergy">//                        |total_energy| &lt;= |kMinEnergy|.</i></td></tr>
<tr><th id="151">151</th><td><i  data-doc="LogOfEnergy">// - log_energy   [o]   : 10 * log10("energy of |data_in|") given in Q4.</i></td></tr>
<tr><th id="152">152</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="LogOfEnergy" title='LogOfEnergy' data-type='void LogOfEnergy(const int16_t * data_in, size_t data_length, int16_t offset, int16_t * total_energy, int16_t * log_energy)' data-ref="LogOfEnergy" data-ref-filename="LogOfEnergy">LogOfEnergy</dfn>(<em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col7 decl" id="27data_in" title='data_in' data-type='const int16_t *' data-ref="27data_in" data-ref-filename="27data_in">data_in</dfn>, <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col8 decl" id="28data_length" title='data_length' data-type='size_t' data-ref="28data_length" data-ref-filename="28data_length">data_length</dfn>,</td></tr>
<tr><th id="153">153</th><td>                        <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="local col9 decl" id="29offset" title='offset' data-type='int16_t' data-ref="29offset" data-ref-filename="29offset">offset</dfn>, <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col0 decl" id="30total_energy" title='total_energy' data-type='int16_t *' data-ref="30total_energy" data-ref-filename="30total_energy">total_energy</dfn>,</td></tr>
<tr><th id="154">154</th><td>                        <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col1 decl" id="31log_energy" title='log_energy' data-type='int16_t *' data-ref="31log_energy" data-ref-filename="31log_energy">log_energy</dfn>) {</td></tr>
<tr><th id="155">155</th><td>  <i>// |tot_rshifts| accumulates the number of right shifts performed on |energy|.</i></td></tr>
<tr><th id="156">156</th><td>  <em>int</em> <dfn class="local col2 decl" id="32tot_rshifts" title='tot_rshifts' data-type='int' data-ref="32tot_rshifts" data-ref-filename="32tot_rshifts">tot_rshifts</dfn> = <var>0</var>;</td></tr>
<tr><th id="157">157</th><td>  <i>// The |energy| will be normalized to 15 bits. We use unsigned integer because</i></td></tr>
<tr><th id="158">158</th><td><i>  // we eventually will mask out the fractional part.</i></td></tr>
<tr><th id="159">159</th><td>  <span class='typedef' title='uint32_t' data-type='unsigned int' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</span> <dfn class="local col3 decl" id="33energy" title='energy' data-type='uint32_t' data-ref="33energy" data-ref-filename="33energy">energy</dfn> = <var>0</var>;</td></tr>
<tr><th id="160">160</th><td></td></tr>
<tr><th id="161">161</th><td>  <a class="macro" href="../../rtc_base/checks.h.html#491" title="do { if (1 &amp;&amp; !(data_in)) { rtc_FatalMessage(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/ThirdParty/libwebrtc/Source/webrtc/common_audio/vad/vad_filterbank.c&quot;, 161, &quot;DCHECK failed: &quot; &quot;data_in&quot;); } } while (0)" data-ref="_M/RTC_DCHECK">RTC_DCHECK</a>(<a class="local col7 ref" href="#27data_in" title='data_in' data-ref="27data_in" data-ref-filename="27data_in">data_in</a>);</td></tr>
<tr><th id="162">162</th><td>  <a class="macro" href="../../rtc_base/checks.h.html#504" title="do { if (1 &amp;&amp; !((data_length) &gt; (0))) { rtc_FatalMessage(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/ThirdParty/libwebrtc/Source/webrtc/common_audio/vad/vad_filterbank.c&quot;, 162, &quot;DCHECK failed: &quot; &quot;(data_length) &gt; (0)&quot;); } } while (0)" data-ref="_M/RTC_DCHECK_GT">RTC_DCHECK_GT</a>(<a class="local col8 ref" href="#28data_length" title='data_length' data-ref="28data_length" data-ref-filename="28data_length">data_length</a>, <var>0</var>);</td></tr>
<tr><th id="163">163</th><td></td></tr>
<tr><th id="164">164</th><td>  <a class="local col3 ref" href="#33energy" title='energy' data-ref="33energy" data-ref-filename="33energy">energy</a> = (<span class='typedef' title='uint32_t' data-type='unsigned int' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</span>) <a class="ref fn" href="../signal_processing/include/signal_processing_library.h.html#WebRtcSpl_Energy" title='WebRtcSpl_Energy' data-ref="WebRtcSpl_Energy" data-ref-filename="WebRtcSpl_Energy">WebRtcSpl_Energy</a>((<span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>*) <a class="local col7 ref" href="#27data_in" title='data_in' data-ref="27data_in" data-ref-filename="27data_in">data_in</a>, <a class="local col8 ref" href="#28data_length" title='data_length' data-ref="28data_length" data-ref-filename="28data_length">data_length</a>,</td></tr>
<tr><th id="165">165</th><td>                                       &amp;<a class="local col2 ref" href="#32tot_rshifts" title='tot_rshifts' data-ref="32tot_rshifts" data-ref-filename="32tot_rshifts">tot_rshifts</a>);</td></tr>
<tr><th id="166">166</th><td></td></tr>
<tr><th id="167">167</th><td>  <b>if</b> (<a class="local col3 ref" href="#33energy" title='energy' data-ref="33energy" data-ref-filename="33energy">energy</a> != <var>0</var>) {</td></tr>
<tr><th id="168">168</th><td>    <i>// By construction, normalizing to 15 bits is equivalent with 17 leading</i></td></tr>
<tr><th id="169">169</th><td><i>    // zeros of an unsigned 32 bit value.</i></td></tr>
<tr><th id="170">170</th><td>    <em>int</em> <dfn class="local col4 decl" id="34normalizing_rshifts" title='normalizing_rshifts' data-type='int' data-ref="34normalizing_rshifts" data-ref-filename="34normalizing_rshifts">normalizing_rshifts</dfn> = <var>17</var> - <a class="ref fn" href="../signal_processing/include/spl_inl.h.html#WebRtcSpl_NormU32" title='WebRtcSpl_NormU32' data-ref="WebRtcSpl_NormU32" data-ref-filename="WebRtcSpl_NormU32">WebRtcSpl_NormU32</a>(<a class="local col3 ref" href="#33energy" title='energy' data-ref="33energy" data-ref-filename="33energy">energy</a>);</td></tr>
<tr><th id="171">171</th><td>    <i>// In a 15 bit representation the leading bit is 2^14. log2(2^14) in Q10 is</i></td></tr>
<tr><th id="172">172</th><td><i>    // (14 &lt;&lt; 10), which is what we initialize |log2_energy| with. For a more</i></td></tr>
<tr><th id="173">173</th><td><i>    // detailed derivations, see below.</i></td></tr>
<tr><th id="174">174</th><td>    <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="local col5 decl" id="35log2_energy" title='log2_energy' data-type='int16_t' data-ref="35log2_energy" data-ref-filename="35log2_energy">log2_energy</dfn> = <a class="tu ref" href="#kLogEnergyIntPart" title='kLogEnergyIntPart' data-use='r' data-ref="kLogEnergyIntPart" data-ref-filename="kLogEnergyIntPart">kLogEnergyIntPart</a>;</td></tr>
<tr><th id="175">175</th><td></td></tr>
<tr><th id="176">176</th><td>    <a class="local col2 ref" href="#32tot_rshifts" title='tot_rshifts' data-ref="32tot_rshifts" data-ref-filename="32tot_rshifts">tot_rshifts</a> += <a class="local col4 ref" href="#34normalizing_rshifts" title='normalizing_rshifts' data-ref="34normalizing_rshifts" data-ref-filename="34normalizing_rshifts">normalizing_rshifts</a>;</td></tr>
<tr><th id="177">177</th><td>    <i>// Normalize |energy| to 15 bits.</i></td></tr>
<tr><th id="178">178</th><td><i>    // |tot_rshifts| is now the total number of right shifts performed on</i></td></tr>
<tr><th id="179">179</th><td><i>    // |energy| after normalization. This means that |energy| is in</i></td></tr>
<tr><th id="180">180</th><td><i>    // Q(-tot_rshifts).</i></td></tr>
<tr><th id="181">181</th><td>    <b>if</b> (<a class="local col4 ref" href="#34normalizing_rshifts" title='normalizing_rshifts' data-ref="34normalizing_rshifts" data-ref-filename="34normalizing_rshifts">normalizing_rshifts</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="182">182</th><td>      <a class="local col3 ref" href="#33energy" title='energy' data-ref="33energy" data-ref-filename="33energy">energy</a> &lt;&lt;= -<a class="local col4 ref" href="#34normalizing_rshifts" title='normalizing_rshifts' data-ref="34normalizing_rshifts" data-ref-filename="34normalizing_rshifts">normalizing_rshifts</a>;</td></tr>
<tr><th id="183">183</th><td>    } <b>else</b> {</td></tr>
<tr><th id="184">184</th><td>      <a class="local col3 ref" href="#33energy" title='energy' data-ref="33energy" data-ref-filename="33energy">energy</a> &gt;&gt;= <a class="local col4 ref" href="#34normalizing_rshifts" title='normalizing_rshifts' data-ref="34normalizing_rshifts" data-ref-filename="34normalizing_rshifts">normalizing_rshifts</a>;</td></tr>
<tr><th id="185">185</th><td>    }</td></tr>
<tr><th id="186">186</th><td></td></tr>
<tr><th id="187">187</th><td>    <i>// Calculate the energy of |data_in| in dB, in Q4.</i></td></tr>
<tr><th id="188">188</th><td><i>    //</i></td></tr>
<tr><th id="189">189</th><td><i>    // 10 * log10("true energy") in Q4 = 2^4 * 10 * log10("true energy") =</i></td></tr>
<tr><th id="190">190</th><td><i>    // 160 * log10(|energy| * 2^|tot_rshifts|) =</i></td></tr>
<tr><th id="191">191</th><td><i>    // 160 * log10(2) * log2(|energy| * 2^|tot_rshifts|) =</i></td></tr>
<tr><th id="192">192</th><td><i>    // 160 * log10(2) * (log2(|energy|) + log2(2^|tot_rshifts|)) =</i></td></tr>
<tr><th id="193">193</th><td><i>    // (160 * log10(2)) * (log2(|energy|) + |tot_rshifts|) =</i></td></tr>
<tr><th id="194">194</th><td><i>    // |kLogConst| * (|log2_energy| + |tot_rshifts|)</i></td></tr>
<tr><th id="195">195</th><td><i>    //</i></td></tr>
<tr><th id="196">196</th><td><i>    // We know by construction that |energy| is normalized to 15 bits. Hence,</i></td></tr>
<tr><th id="197">197</th><td><i>    // |energy| = 2^14 + frac_Q15, where frac_Q15 is a fractional part in Q15.</i></td></tr>
<tr><th id="198">198</th><td><i>    // Further, we'd like |log2_energy| in Q10</i></td></tr>
<tr><th id="199">199</th><td><i>    // log2(|energy|) in Q10 = 2^10 * log2(2^14 + frac_Q15) =</i></td></tr>
<tr><th id="200">200</th><td><i>    // 2^10 * log2(2^14 * (1 + frac_Q15 * 2^-14)) =</i></td></tr>
<tr><th id="201">201</th><td><i>    // 2^10 * (14 + log2(1 + frac_Q15 * 2^-14)) ~=</i></td></tr>
<tr><th id="202">202</th><td><i>    // (14 &lt;&lt; 10) + 2^10 * (frac_Q15 * 2^-14) =</i></td></tr>
<tr><th id="203">203</th><td><i>    // (14 &lt;&lt; 10) + (frac_Q15 * 2^-4) = (14 &lt;&lt; 10) + (frac_Q15 &gt;&gt; 4)</i></td></tr>
<tr><th id="204">204</th><td><i>    //</i></td></tr>
<tr><th id="205">205</th><td><i>    // Note that frac_Q15 = (|energy| &amp; 0x00003FFF)</i></td></tr>
<tr><th id="206">206</th><td><i></i></td></tr>
<tr><th id="207">207</th><td><i>    // Calculate and add the fractional part to |log2_energy|.</i></td></tr>
<tr><th id="208">208</th><td>    <a class="local col5 ref" href="#35log2_energy" title='log2_energy' data-ref="35log2_energy" data-ref-filename="35log2_energy">log2_energy</a> += (<span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>) ((<a class="local col3 ref" href="#33energy" title='energy' data-ref="33energy" data-ref-filename="33energy">energy</a> &amp; <var>0x00003FFF</var>) &gt;&gt; <var>4</var>);</td></tr>
<tr><th id="209">209</th><td></td></tr>
<tr><th id="210">210</th><td>    <i>// |kLogConst| is in Q9, |log2_energy| in Q10 and |tot_rshifts| in Q0.</i></td></tr>
<tr><th id="211">211</th><td><i>    // Note that we in our derivation above have accounted for an output in Q4.</i></td></tr>
<tr><th id="212">212</th><td>    *<a class="local col1 ref" href="#31log_energy" title='log_energy' data-ref="31log_energy" data-ref-filename="31log_energy">log_energy</a> = (<span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>)(((<a class="tu ref" href="#kLogConst" title='kLogConst' data-use='r' data-ref="kLogConst" data-ref-filename="kLogConst">kLogConst</a> * <a class="local col5 ref" href="#35log2_energy" title='log2_energy' data-ref="35log2_energy" data-ref-filename="35log2_energy">log2_energy</a>) &gt;&gt; <var>19</var>) +</td></tr>
<tr><th id="213">213</th><td>        ((<a class="local col2 ref" href="#32tot_rshifts" title='tot_rshifts' data-ref="32tot_rshifts" data-ref-filename="32tot_rshifts">tot_rshifts</a> * <a class="tu ref" href="#kLogConst" title='kLogConst' data-use='r' data-ref="kLogConst" data-ref-filename="kLogConst">kLogConst</a>) &gt;&gt; <var>9</var>));</td></tr>
<tr><th id="214">214</th><td></td></tr>
<tr><th id="215">215</th><td>    <b>if</b> (*<a class="local col1 ref" href="#31log_energy" title='log_energy' data-ref="31log_energy" data-ref-filename="31log_energy">log_energy</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="216">216</th><td>      *<a class="local col1 ref" href="#31log_energy" title='log_energy' data-ref="31log_energy" data-ref-filename="31log_energy">log_energy</a> = <var>0</var>;</td></tr>
<tr><th id="217">217</th><td>    }</td></tr>
<tr><th id="218">218</th><td>  } <b>else</b> {</td></tr>
<tr><th id="219">219</th><td>    *<a class="local col1 ref" href="#31log_energy" title='log_energy' data-ref="31log_energy" data-ref-filename="31log_energy">log_energy</a> = <a class="local col9 ref" href="#29offset" title='offset' data-ref="29offset" data-ref-filename="29offset">offset</a>;</td></tr>
<tr><th id="220">220</th><td>    <b>return</b>;</td></tr>
<tr><th id="221">221</th><td>  }</td></tr>
<tr><th id="222">222</th><td></td></tr>
<tr><th id="223">223</th><td>  *<a class="local col1 ref" href="#31log_energy" title='log_energy' data-ref="31log_energy" data-ref-filename="31log_energy">log_energy</a> += <a class="local col9 ref" href="#29offset" title='offset' data-ref="29offset" data-ref-filename="29offset">offset</a>;</td></tr>
<tr><th id="224">224</th><td></td></tr>
<tr><th id="225">225</th><td>  <i>// Update the approximate |total_energy| with the energy of |data_in|, if</i></td></tr>
<tr><th id="226">226</th><td><i>  // |total_energy| has not exceeded |kMinEnergy|. |total_energy| is used as an</i></td></tr>
<tr><th id="227">227</th><td><i>  // energy indicator in WebRtcVad_GmmProbability() in vad_core.c.</i></td></tr>
<tr><th id="228">228</th><td>  <b>if</b> (*<a class="local col0 ref" href="#30total_energy" title='total_energy' data-ref="30total_energy" data-ref-filename="30total_energy">total_energy</a> &lt;= <a class="enum" href="vad_core.h.html#kMinEnergy" title='kMinEnergy' data-ref="kMinEnergy" data-ref-filename="kMinEnergy">kMinEnergy</a>) {</td></tr>
<tr><th id="229">229</th><td>    <b>if</b> (<a class="local col2 ref" href="#32tot_rshifts" title='tot_rshifts' data-ref="32tot_rshifts" data-ref-filename="32tot_rshifts">tot_rshifts</a> &gt;= <var>0</var>) {</td></tr>
<tr><th id="230">230</th><td>      <i>// We know by construction that the |energy| &gt; |kMinEnergy| in Q0, so add</i></td></tr>
<tr><th id="231">231</th><td><i>      // an arbitrary value such that |total_energy| exceeds |kMinEnergy|.</i></td></tr>
<tr><th id="232">232</th><td>      *<a class="local col0 ref" href="#30total_energy" title='total_energy' data-ref="30total_energy" data-ref-filename="30total_energy">total_energy</a> += <a class="enum" href="vad_core.h.html#kMinEnergy" title='kMinEnergy' data-ref="kMinEnergy" data-ref-filename="kMinEnergy">kMinEnergy</a> + <var>1</var>;</td></tr>
<tr><th id="233">233</th><td>    } <b>else</b> {</td></tr>
<tr><th id="234">234</th><td>      <i>// By construction |energy| is represented by 15 bits, hence any number of</i></td></tr>
<tr><th id="235">235</th><td><i>      // right shifted |energy| will fit in an int16_t. In addition, adding the</i></td></tr>
<tr><th id="236">236</th><td><i>      // value to |total_energy| is wrap around safe as long as</i></td></tr>
<tr><th id="237">237</th><td><i>      // |kMinEnergy| &lt; 8192.</i></td></tr>
<tr><th id="238">238</th><td>      *<a class="local col0 ref" href="#30total_energy" title='total_energy' data-ref="30total_energy" data-ref-filename="30total_energy">total_energy</a> += (<span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>) (<a class="local col3 ref" href="#33energy" title='energy' data-ref="33energy" data-ref-filename="33energy">energy</a> &gt;&gt; -<a class="local col2 ref" href="#32tot_rshifts" title='tot_rshifts' data-ref="32tot_rshifts" data-ref-filename="32tot_rshifts">tot_rshifts</a>);  <i>// Q0.</i></td></tr>
<tr><th id="239">239</th><td>    }</td></tr>
<tr><th id="240">240</th><td>  }</td></tr>
<tr><th id="241">241</th><td>}</td></tr>
<tr><th id="242">242</th><td></td></tr>
<tr><th id="243">243</th><td><span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="decl def fn" id="WebRtcVad_CalculateFeatures" title='WebRtcVad_CalculateFeatures' data-ref="WebRtcVad_CalculateFeatures" data-ref-filename="WebRtcVad_CalculateFeatures">WebRtcVad_CalculateFeatures</dfn>(<a class="typedef" href="vad_core.h.html#VadInstT" title='VadInstT' data-type='struct VadInstT_' data-ref="VadInstT" data-ref-filename="VadInstT">VadInstT</a>* <dfn class="local col6 decl" id="36self" title='self' data-type='VadInstT *' data-ref="36self" data-ref-filename="36self">self</dfn>, <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col7 decl" id="37data_in" title='data_in' data-type='const int16_t *' data-ref="37data_in" data-ref-filename="37data_in">data_in</dfn>,</td></tr>
<tr><th id="244">244</th><td>                                    <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col8 decl" id="38data_length" title='data_length' data-type='size_t' data-ref="38data_length" data-ref-filename="38data_length">data_length</dfn>, <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col9 decl" id="39features" title='features' data-type='int16_t *' data-ref="39features" data-ref-filename="39features">features</dfn>) {</td></tr>
<tr><th id="245">245</th><td>  <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="local col0 decl" id="40total_energy" title='total_energy' data-type='int16_t' data-ref="40total_energy" data-ref-filename="40total_energy">total_energy</dfn> = <var>0</var>;</td></tr>
<tr><th id="246">246</th><td>  <i>// We expect |data_length| to be 80, 160 or 240 samples, which corresponds to</i></td></tr>
<tr><th id="247">247</th><td><i>  // 10, 20 or 30 ms in 8 kHz. Therefore, the intermediate downsampled data will</i></td></tr>
<tr><th id="248">248</th><td><i>  // have at most 120 samples after the first split and at most 60 samples after</i></td></tr>
<tr><th id="249">249</th><td><i>  // the second split.</i></td></tr>
<tr><th id="250">250</th><td>  <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="local col1 decl" id="41hp_120" title='hp_120' data-type='int16_t [120]' data-ref="41hp_120" data-ref-filename="41hp_120">hp_120</dfn>[<var>120</var>], <dfn class="local col2 decl" id="42lp_120" title='lp_120' data-type='int16_t [120]' data-ref="42lp_120" data-ref-filename="42lp_120">lp_120</dfn>[<var>120</var>];</td></tr>
<tr><th id="251">251</th><td>  <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span> <dfn class="local col3 decl" id="43hp_60" title='hp_60' data-type='int16_t [60]' data-ref="43hp_60" data-ref-filename="43hp_60">hp_60</dfn>[<var>60</var>], <dfn class="local col4 decl" id="44lp_60" title='lp_60' data-type='int16_t [60]' data-ref="44lp_60" data-ref-filename="44lp_60">lp_60</dfn>[<var>60</var>];</td></tr>
<tr><th id="252">252</th><td>  <em>const</em> <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col5 decl" id="45half_data_length" title='half_data_length' data-type='const size_t' data-ref="45half_data_length" data-ref-filename="45half_data_length">half_data_length</dfn> = <a class="local col8 ref" href="#38data_length" title='data_length' data-ref="38data_length" data-ref-filename="38data_length">data_length</a> &gt;&gt; <var>1</var>;</td></tr>
<tr><th id="253">253</th><td>  <span class='typedef' title='size_t' data-type='__darwin_size_t' data-ref="size_t" data-ref-filename="size_t">size_t</span> <dfn class="local col6 decl" id="46length" title='length' data-type='size_t' data-ref="46length" data-ref-filename="46length">length</dfn> = <a class="local col5 ref" href="#45half_data_length" title='half_data_length' data-ref="45half_data_length" data-ref-filename="45half_data_length">half_data_length</a>;  <i>// |data_length| / 2, corresponds to</i></td></tr>
<tr><th id="254">254</th><td>                                     <i>// bandwidth = 2000 Hz after downsampling.</i></td></tr>
<tr><th id="255">255</th><td><i></i></td></tr>
<tr><th id="256">256</th><td><i>  // Initialize variables for the first SplitFilter().</i></td></tr>
<tr><th id="257">257</th><td>  <em>int</em> <dfn class="local col7 decl" id="47frequency_band" title='frequency_band' data-type='int' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</dfn> = <var>0</var>;</td></tr>
<tr><th id="258">258</th><td>  <em>const</em> <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col8 decl" id="48in_ptr" title='in_ptr' data-type='const int16_t *' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</dfn> = <a class="local col7 ref" href="#37data_in" title='data_in' data-ref="37data_in" data-ref-filename="37data_in">data_in</a>;  <i>// [0 - 4000] Hz.</i></td></tr>
<tr><th id="259">259</th><td>  <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col9 decl" id="49hp_out_ptr" title='hp_out_ptr' data-type='int16_t *' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</dfn> = <a class="local col1 ref" href="#41hp_120" title='hp_120' data-ref="41hp_120" data-ref-filename="41hp_120">hp_120</a>;  <i>// [2000 - 4000] Hz.</i></td></tr>
<tr><th id="260">260</th><td>  <span class='typedef' title='int16_t' data-type='short' data-ref="int16_t" data-ref-filename="int16_t">int16_t</span>* <dfn class="local col0 decl" id="50lp_out_ptr" title='lp_out_ptr' data-type='int16_t *' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</dfn> = <a class="local col2 ref" href="#42lp_120" title='lp_120' data-ref="42lp_120" data-ref-filename="42lp_120">lp_120</a>;  <i>// [0 - 2000] Hz.</i></td></tr>
<tr><th id="261">261</th><td></td></tr>
<tr><th id="262">262</th><td>  <a class="macro" href="../../rtc_base/checks.h.html#501" title="do { if (1 &amp;&amp; !((data_length) &lt;= (240))) { rtc_FatalMessage(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/ThirdParty/libwebrtc/Source/webrtc/common_audio/vad/vad_filterbank.c&quot;, 262, &quot;DCHECK failed: &quot; &quot;(data_length) &lt;= (240)&quot;); } } while (0)" data-ref="_M/RTC_DCHECK_LE">RTC_DCHECK_LE</a>(<a class="local col8 ref" href="#38data_length" title='data_length' data-ref="38data_length" data-ref-filename="38data_length">data_length</a>, <var>240</var>);</td></tr>
<tr><th id="263">263</th><td>  <a class="macro" href="../../rtc_base/checks.h.html#502" title="do { if (1 &amp;&amp; !((4) &lt; (kNumChannels - 1))) { rtc_FatalMessage(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/ThirdParty/libwebrtc/Source/webrtc/common_audio/vad/vad_filterbank.c&quot;, 263, &quot;DCHECK failed: &quot; &quot;(4) &lt; (kNumChannels - 1)&quot;); } } while (0)" data-ref="_M/RTC_DCHECK_LT">RTC_DCHECK_LT</a>(<var>4</var>, <a class="enum" href="vad_core.h.html#kNumChannels" title='kNumChannels' data-ref="kNumChannels" data-ref-filename="kNumChannels">kNumChannels</a> - <var>1</var>);  <i>// Checking maximum |frequency_band|.</i></td></tr>
<tr><th id="264">264</th><td></td></tr>
<tr><th id="265">265</th><td>  <i>// Split at 2000 Hz and downsample.</i></td></tr>
<tr><th id="266">266</th><td>  <a class="tu ref fn" href="#SplitFilter" title='SplitFilter' data-use='c' data-ref="SplitFilter" data-ref-filename="SplitFilter">SplitFilter</a>(<a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a>, <a class="local col8 ref" href="#38data_length" title='data_length' data-ref="38data_length" data-ref-filename="38data_length">data_length</a>, &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::upper_state" title='VadInstT_::upper_state' data-ref="VadInstT_::upper_state" data-ref-filename="VadInstT_..upper_state">upper_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>],</td></tr>
<tr><th id="267">267</th><td>              &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::lower_state" title='VadInstT_::lower_state' data-ref="VadInstT_::lower_state" data-ref-filename="VadInstT_..lower_state">lower_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>], <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a>, <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a>);</td></tr>
<tr><th id="268">268</th><td></td></tr>
<tr><th id="269">269</th><td>  <i>// For the upper band (2000 Hz - 4000 Hz) split at 3000 Hz and downsample.</i></td></tr>
<tr><th id="270">270</th><td>  <a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a> = <var>1</var>;</td></tr>
<tr><th id="271">271</th><td>  <a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a> = <a class="local col1 ref" href="#41hp_120" title='hp_120' data-ref="41hp_120" data-ref-filename="41hp_120">hp_120</a>;  <i>// [2000 - 4000] Hz.</i></td></tr>
<tr><th id="272">272</th><td>  <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a> = <a class="local col3 ref" href="#43hp_60" title='hp_60' data-ref="43hp_60" data-ref-filename="43hp_60">hp_60</a>;  <i>// [3000 - 4000] Hz.</i></td></tr>
<tr><th id="273">273</th><td>  <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a> = <a class="local col4 ref" href="#44lp_60" title='lp_60' data-ref="44lp_60" data-ref-filename="44lp_60">lp_60</a>;  <i>// [2000 - 3000] Hz.</i></td></tr>
<tr><th id="274">274</th><td>  <a class="tu ref fn" href="#SplitFilter" title='SplitFilter' data-use='c' data-ref="SplitFilter" data-ref-filename="SplitFilter">SplitFilter</a>(<a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::upper_state" title='VadInstT_::upper_state' data-ref="VadInstT_::upper_state" data-ref-filename="VadInstT_..upper_state">upper_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>],</td></tr>
<tr><th id="275">275</th><td>              &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::lower_state" title='VadInstT_::lower_state' data-ref="VadInstT_::lower_state" data-ref-filename="VadInstT_..lower_state">lower_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>], <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a>, <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a>);</td></tr>
<tr><th id="276">276</th><td></td></tr>
<tr><th id="277">277</th><td>  <i>// Energy in 3000 Hz - 4000 Hz.</i></td></tr>
<tr><th id="278">278</th><td>  <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a> &gt;&gt;= <var>1</var>;  <i>// |data_length| / 4 &lt;=&gt; bandwidth = 1000 Hz.</i></td></tr>
<tr><th id="279">279</th><td></td></tr>
<tr><th id="280">280</th><td>  <a class="tu ref fn" href="#LogOfEnergy" title='LogOfEnergy' data-use='c' data-ref="LogOfEnergy" data-ref-filename="LogOfEnergy">LogOfEnergy</a>(<a class="local col3 ref" href="#43hp_60" title='hp_60' data-ref="43hp_60" data-ref-filename="43hp_60">hp_60</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, <a class="tu ref" href="#kOffsetVector" title='kOffsetVector' data-use='r' data-ref="kOffsetVector" data-ref-filename="kOffsetVector">kOffsetVector</a>[<var>5</var>], &amp;<a class="local col0 ref" href="#40total_energy" title='total_energy' data-ref="40total_energy" data-ref-filename="40total_energy">total_energy</a>, &amp;<a class="local col9 ref" href="#39features" title='features' data-ref="39features" data-ref-filename="39features">features</a>[<var>5</var>]);</td></tr>
<tr><th id="281">281</th><td></td></tr>
<tr><th id="282">282</th><td>  <i>// Energy in 2000 Hz - 3000 Hz.</i></td></tr>
<tr><th id="283">283</th><td>  <a class="tu ref fn" href="#LogOfEnergy" title='LogOfEnergy' data-use='c' data-ref="LogOfEnergy" data-ref-filename="LogOfEnergy">LogOfEnergy</a>(<a class="local col4 ref" href="#44lp_60" title='lp_60' data-ref="44lp_60" data-ref-filename="44lp_60">lp_60</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, <a class="tu ref" href="#kOffsetVector" title='kOffsetVector' data-use='r' data-ref="kOffsetVector" data-ref-filename="kOffsetVector">kOffsetVector</a>[<var>4</var>], &amp;<a class="local col0 ref" href="#40total_energy" title='total_energy' data-ref="40total_energy" data-ref-filename="40total_energy">total_energy</a>, &amp;<a class="local col9 ref" href="#39features" title='features' data-ref="39features" data-ref-filename="39features">features</a>[<var>4</var>]);</td></tr>
<tr><th id="284">284</th><td></td></tr>
<tr><th id="285">285</th><td>  <i>// For the lower band (0 Hz - 2000 Hz) split at 1000 Hz and downsample.</i></td></tr>
<tr><th id="286">286</th><td>  <a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a> = <var>2</var>;</td></tr>
<tr><th id="287">287</th><td>  <a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a> = <a class="local col2 ref" href="#42lp_120" title='lp_120' data-ref="42lp_120" data-ref-filename="42lp_120">lp_120</a>;  <i>// [0 - 2000] Hz.</i></td></tr>
<tr><th id="288">288</th><td>  <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a> = <a class="local col3 ref" href="#43hp_60" title='hp_60' data-ref="43hp_60" data-ref-filename="43hp_60">hp_60</a>;  <i>// [1000 - 2000] Hz.</i></td></tr>
<tr><th id="289">289</th><td>  <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a> = <a class="local col4 ref" href="#44lp_60" title='lp_60' data-ref="44lp_60" data-ref-filename="44lp_60">lp_60</a>;  <i>// [0 - 1000] Hz.</i></td></tr>
<tr><th id="290">290</th><td>  <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a> = <a class="local col5 ref" href="#45half_data_length" title='half_data_length' data-ref="45half_data_length" data-ref-filename="45half_data_length">half_data_length</a>;  <i>// |data_length| / 2 &lt;=&gt; bandwidth = 2000 Hz.</i></td></tr>
<tr><th id="291">291</th><td>  <a class="tu ref fn" href="#SplitFilter" title='SplitFilter' data-use='c' data-ref="SplitFilter" data-ref-filename="SplitFilter">SplitFilter</a>(<a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::upper_state" title='VadInstT_::upper_state' data-ref="VadInstT_::upper_state" data-ref-filename="VadInstT_..upper_state">upper_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>],</td></tr>
<tr><th id="292">292</th><td>              &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::lower_state" title='VadInstT_::lower_state' data-ref="VadInstT_::lower_state" data-ref-filename="VadInstT_..lower_state">lower_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>], <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a>, <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a>);</td></tr>
<tr><th id="293">293</th><td></td></tr>
<tr><th id="294">294</th><td>  <i>// Energy in 1000 Hz - 2000 Hz.</i></td></tr>
<tr><th id="295">295</th><td>  <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a> &gt;&gt;= <var>1</var>;  <i>// |data_length| / 4 &lt;=&gt; bandwidth = 1000 Hz.</i></td></tr>
<tr><th id="296">296</th><td>  <a class="tu ref fn" href="#LogOfEnergy" title='LogOfEnergy' data-use='c' data-ref="LogOfEnergy" data-ref-filename="LogOfEnergy">LogOfEnergy</a>(<a class="local col3 ref" href="#43hp_60" title='hp_60' data-ref="43hp_60" data-ref-filename="43hp_60">hp_60</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, <a class="tu ref" href="#kOffsetVector" title='kOffsetVector' data-use='r' data-ref="kOffsetVector" data-ref-filename="kOffsetVector">kOffsetVector</a>[<var>3</var>], &amp;<a class="local col0 ref" href="#40total_energy" title='total_energy' data-ref="40total_energy" data-ref-filename="40total_energy">total_energy</a>, &amp;<a class="local col9 ref" href="#39features" title='features' data-ref="39features" data-ref-filename="39features">features</a>[<var>3</var>]);</td></tr>
<tr><th id="297">297</th><td></td></tr>
<tr><th id="298">298</th><td>  <i>// For the lower band (0 Hz - 1000 Hz) split at 500 Hz and downsample.</i></td></tr>
<tr><th id="299">299</th><td>  <a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a> = <var>3</var>;</td></tr>
<tr><th id="300">300</th><td>  <a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a> = <a class="local col4 ref" href="#44lp_60" title='lp_60' data-ref="44lp_60" data-ref-filename="44lp_60">lp_60</a>;  <i>// [0 - 1000] Hz.</i></td></tr>
<tr><th id="301">301</th><td>  <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a> = <a class="local col1 ref" href="#41hp_120" title='hp_120' data-ref="41hp_120" data-ref-filename="41hp_120">hp_120</a>;  <i>// [500 - 1000] Hz.</i></td></tr>
<tr><th id="302">302</th><td>  <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a> = <a class="local col2 ref" href="#42lp_120" title='lp_120' data-ref="42lp_120" data-ref-filename="42lp_120">lp_120</a>;  <i>// [0 - 500] Hz.</i></td></tr>
<tr><th id="303">303</th><td>  <a class="tu ref fn" href="#SplitFilter" title='SplitFilter' data-use='c' data-ref="SplitFilter" data-ref-filename="SplitFilter">SplitFilter</a>(<a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::upper_state" title='VadInstT_::upper_state' data-ref="VadInstT_::upper_state" data-ref-filename="VadInstT_..upper_state">upper_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>],</td></tr>
<tr><th id="304">304</th><td>              &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::lower_state" title='VadInstT_::lower_state' data-ref="VadInstT_::lower_state" data-ref-filename="VadInstT_..lower_state">lower_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>], <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a>, <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a>);</td></tr>
<tr><th id="305">305</th><td></td></tr>
<tr><th id="306">306</th><td>  <i>// Energy in 500 Hz - 1000 Hz.</i></td></tr>
<tr><th id="307">307</th><td>  <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a> &gt;&gt;= <var>1</var>;  <i>// |data_length| / 8 &lt;=&gt; bandwidth = 500 Hz.</i></td></tr>
<tr><th id="308">308</th><td>  <a class="tu ref fn" href="#LogOfEnergy" title='LogOfEnergy' data-use='c' data-ref="LogOfEnergy" data-ref-filename="LogOfEnergy">LogOfEnergy</a>(<a class="local col1 ref" href="#41hp_120" title='hp_120' data-ref="41hp_120" data-ref-filename="41hp_120">hp_120</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, <a class="tu ref" href="#kOffsetVector" title='kOffsetVector' data-use='r' data-ref="kOffsetVector" data-ref-filename="kOffsetVector">kOffsetVector</a>[<var>2</var>], &amp;<a class="local col0 ref" href="#40total_energy" title='total_energy' data-ref="40total_energy" data-ref-filename="40total_energy">total_energy</a>, &amp;<a class="local col9 ref" href="#39features" title='features' data-ref="39features" data-ref-filename="39features">features</a>[<var>2</var>]);</td></tr>
<tr><th id="309">309</th><td></td></tr>
<tr><th id="310">310</th><td>  <i>// For the lower band (0 Hz - 500 Hz) split at 250 Hz and downsample.</i></td></tr>
<tr><th id="311">311</th><td>  <a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a> = <var>4</var>;</td></tr>
<tr><th id="312">312</th><td>  <a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a> = <a class="local col2 ref" href="#42lp_120" title='lp_120' data-ref="42lp_120" data-ref-filename="42lp_120">lp_120</a>;  <i>// [0 - 500] Hz.</i></td></tr>
<tr><th id="313">313</th><td>  <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a> = <a class="local col3 ref" href="#43hp_60" title='hp_60' data-ref="43hp_60" data-ref-filename="43hp_60">hp_60</a>;  <i>// [250 - 500] Hz.</i></td></tr>
<tr><th id="314">314</th><td>  <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a> = <a class="local col4 ref" href="#44lp_60" title='lp_60' data-ref="44lp_60" data-ref-filename="44lp_60">lp_60</a>;  <i>// [0 - 250] Hz.</i></td></tr>
<tr><th id="315">315</th><td>  <a class="tu ref fn" href="#SplitFilter" title='SplitFilter' data-use='c' data-ref="SplitFilter" data-ref-filename="SplitFilter">SplitFilter</a>(<a class="local col8 ref" href="#48in_ptr" title='in_ptr' data-ref="48in_ptr" data-ref-filename="48in_ptr">in_ptr</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::upper_state" title='VadInstT_::upper_state' data-ref="VadInstT_::upper_state" data-ref-filename="VadInstT_..upper_state">upper_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>],</td></tr>
<tr><th id="316">316</th><td>              &amp;<a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::lower_state" title='VadInstT_::lower_state' data-ref="VadInstT_::lower_state" data-ref-filename="VadInstT_..lower_state">lower_state</a>[<a class="local col7 ref" href="#47frequency_band" title='frequency_band' data-ref="47frequency_band" data-ref-filename="47frequency_band">frequency_band</a>], <a class="local col9 ref" href="#49hp_out_ptr" title='hp_out_ptr' data-ref="49hp_out_ptr" data-ref-filename="49hp_out_ptr">hp_out_ptr</a>, <a class="local col0 ref" href="#50lp_out_ptr" title='lp_out_ptr' data-ref="50lp_out_ptr" data-ref-filename="50lp_out_ptr">lp_out_ptr</a>);</td></tr>
<tr><th id="317">317</th><td></td></tr>
<tr><th id="318">318</th><td>  <i>// Energy in 250 Hz - 500 Hz.</i></td></tr>
<tr><th id="319">319</th><td>  <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a> &gt;&gt;= <var>1</var>;  <i>// |data_length| / 16 &lt;=&gt; bandwidth = 250 Hz.</i></td></tr>
<tr><th id="320">320</th><td>  <a class="tu ref fn" href="#LogOfEnergy" title='LogOfEnergy' data-use='c' data-ref="LogOfEnergy" data-ref-filename="LogOfEnergy">LogOfEnergy</a>(<a class="local col3 ref" href="#43hp_60" title='hp_60' data-ref="43hp_60" data-ref-filename="43hp_60">hp_60</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, <a class="tu ref" href="#kOffsetVector" title='kOffsetVector' data-use='r' data-ref="kOffsetVector" data-ref-filename="kOffsetVector">kOffsetVector</a>[<var>1</var>], &amp;<a class="local col0 ref" href="#40total_energy" title='total_energy' data-ref="40total_energy" data-ref-filename="40total_energy">total_energy</a>, &amp;<a class="local col9 ref" href="#39features" title='features' data-ref="39features" data-ref-filename="39features">features</a>[<var>1</var>]);</td></tr>
<tr><th id="321">321</th><td></td></tr>
<tr><th id="322">322</th><td>  <i>// Remove 0 Hz - 80 Hz, by high pass filtering the lower band.</i></td></tr>
<tr><th id="323">323</th><td>  <a class="tu ref fn" href="#HighPassFilter" title='HighPassFilter' data-use='c' data-ref="HighPassFilter" data-ref-filename="HighPassFilter">HighPassFilter</a>(<a class="local col4 ref" href="#44lp_60" title='lp_60' data-ref="44lp_60" data-ref-filename="44lp_60">lp_60</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, <a class="local col6 ref" href="#36self" title='self' data-ref="36self" data-ref-filename="36self">self</a>-&gt;<a class="ref field" href="vad_core.h.html#VadInstT_::hp_filter_state" title='VadInstT_::hp_filter_state' data-ref="VadInstT_::hp_filter_state" data-ref-filename="VadInstT_..hp_filter_state">hp_filter_state</a>, <a class="local col1 ref" href="#41hp_120" title='hp_120' data-ref="41hp_120" data-ref-filename="41hp_120">hp_120</a>);</td></tr>
<tr><th id="324">324</th><td></td></tr>
<tr><th id="325">325</th><td>  <i>// Energy in 80 Hz - 250 Hz.</i></td></tr>
<tr><th id="326">326</th><td>  <a class="tu ref fn" href="#LogOfEnergy" title='LogOfEnergy' data-use='c' data-ref="LogOfEnergy" data-ref-filename="LogOfEnergy">LogOfEnergy</a>(<a class="local col1 ref" href="#41hp_120" title='hp_120' data-ref="41hp_120" data-ref-filename="41hp_120">hp_120</a>, <a class="local col6 ref" href="#46length" title='length' data-ref="46length" data-ref-filename="46length">length</a>, <a class="tu ref" href="#kOffsetVector" title='kOffsetVector' data-use='r' data-ref="kOffsetVector" data-ref-filename="kOffsetVector">kOffsetVector</a>[<var>0</var>], &amp;<a class="local col0 ref" href="#40total_energy" title='total_energy' data-ref="40total_energy" data-ref-filename="40total_energy">total_energy</a>, &amp;<a class="local col9 ref" href="#39features" title='features' data-ref="39features" data-ref-filename="39features">features</a>[<var>0</var>]);</td></tr>
<tr><th id="327">327</th><td></td></tr>
<tr><th id="328">328</th><td>  <b>return</b> <a class="local col0 ref" href="#40total_energy" title='total_energy' data-ref="40total_energy" data-ref-filename="40total_energy">total_energy</a>;</td></tr>
<tr><th id="329">329</th><td>}</td></tr>
<tr><th id="330">330</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2021-Jul-06</em> from project webkit<br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
