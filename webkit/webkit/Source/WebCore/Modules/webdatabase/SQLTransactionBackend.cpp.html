<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>SQLTransactionBackend.cpp source code [webkit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'webkit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp'; var root_path = '../../../../..'; var data_path = '../../../../../../data'; var ecma_script_api_version = 2;</script>
<script src='../../../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../..'>webkit</a>/<a href='../../..'>Source</a>/<a href='../..'>WebCore</a>/<a href='..'>Modules</a>/<a href='./'>webdatabase</a>/<a href='SQLTransactionBackend.cpp.html'>SQLTransactionBackend.cpp</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * Copyright (C) 2007, 2008, 2013 Apple Inc. All rights reserved.</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * Redistribution and use in source and binary forms, with or without</i></td></tr>
<tr><th id="5">5</th><td><i> * modification, are permitted provided that the following conditions</i></td></tr>
<tr><th id="6">6</th><td><i> * are met:</i></td></tr>
<tr><th id="7">7</th><td><i> *</i></td></tr>
<tr><th id="8">8</th><td><i> * 1.  Redistributions of source code must retain the above copyright</i></td></tr>
<tr><th id="9">9</th><td><i> *     notice, this list of conditions and the following disclaimer.</i></td></tr>
<tr><th id="10">10</th><td><i> * 2.  Redistributions in binary form must reproduce the above copyright</i></td></tr>
<tr><th id="11">11</th><td><i> *     notice, this list of conditions and the following disclaimer in the</i></td></tr>
<tr><th id="12">12</th><td><i> *     documentation and/or other materials provided with the distribution.</i></td></tr>
<tr><th id="13">13</th><td><i> * 3.  Neither the name of Apple Inc. ("Apple") nor the names of</i></td></tr>
<tr><th id="14">14</th><td><i> *     its contributors may be used to endorse or promote products derived</i></td></tr>
<tr><th id="15">15</th><td><i> *     from this software without specific prior written permission.</i></td></tr>
<tr><th id="16">16</th><td><i> *</i></td></tr>
<tr><th id="17">17</th><td><i> * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY</i></td></tr>
<tr><th id="18">18</th><td><i> * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</i></td></tr>
<tr><th id="19">19</th><td><i> * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</i></td></tr>
<tr><th id="20">20</th><td><i> * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY</i></td></tr>
<tr><th id="21">21</th><td><i> * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</i></td></tr>
<tr><th id="22">22</th><td><i> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</i></td></tr>
<tr><th id="23">23</th><td><i> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</i></td></tr>
<tr><th id="24">24</th><td><i> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</i></td></tr>
<tr><th id="25">25</th><td><i> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</i></td></tr>
<tr><th id="26">26</th><td><i> * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</i></td></tr>
<tr><th id="27">27</th><td><i> */</i></td></tr>
<tr><th id="28">28</th><td></td></tr>
<tr><th id="29">29</th><td><u>#include <a href="../../config.h.html">"config.h"</a></u></td></tr>
<tr><th id="30">30</th><td><u>#include <a href="SQLTransactionBackend.h.html">"SQLTransactionBackend.h"</a></u></td></tr>
<tr><th id="31">31</th><td></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="Database.h.html">"Database.h"</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="DatabaseAuthorizer.h.html">"DatabaseAuthorizer.h"</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="DatabaseContext.h.html">"DatabaseContext.h"</a></u></td></tr>
<tr><th id="35">35</th><td><u>#include <a href="DatabaseThread.h.html">"DatabaseThread.h"</a></u></td></tr>
<tr><th id="36">36</th><td><u>#include <a href="DatabaseTracker.h.html">"DatabaseTracker.h"</a></u></td></tr>
<tr><th id="37">37</th><td><u>#include <a href="../../platform/Logging.h.html">"Logging.h"</a></u></td></tr>
<tr><th id="38">38</th><td><u>#include <a href="OriginLock.h.html">"OriginLock.h"</a></u></td></tr>
<tr><th id="39">39</th><td><u>#include <a href="SQLError.h.html">"SQLError.h"</a></u></td></tr>
<tr><th id="40">40</th><td><u>#include <a href="SQLStatement.h.html">"SQLStatement.h"</a></u></td></tr>
<tr><th id="41">41</th><td><u>#include <a href="SQLStatementCallback.h.html">"SQLStatementCallback.h"</a></u></td></tr>
<tr><th id="42">42</th><td><u>#include <a href="SQLStatementErrorCallback.h.html">"SQLStatementErrorCallback.h"</a></u></td></tr>
<tr><th id="43">43</th><td><u>#include <a href="SQLTransaction.h.html">"SQLTransaction.h"</a></u></td></tr>
<tr><th id="44">44</th><td><u>#include <a href="SQLTransactionCoordinator.h.html">"SQLTransactionCoordinator.h"</a></u></td></tr>
<tr><th id="45">45</th><td><u>#include <a href="../../platform/sql/SQLiteTransaction.h.html">"SQLiteTransaction.h"</a></u></td></tr>
<tr><th id="46">46</th><td><u>#include <a href="../../../../WebKitBuild/Debug/usr/local/include/wtf/StdLibExtras.h.html">&lt;wtf/StdLibExtras.h&gt;</a></u></td></tr>
<tr><th id="47">47</th><td><u>#include <a href="../../../../WebKitBuild/Debug/usr/local/include/wtf/text/WTFString.h.html">&lt;wtf/text/WTFString.h&gt;</a></u></td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td></td></tr>
<tr><th id="50">50</th><td><i>// How does a SQLTransaction work?</i></td></tr>
<tr><th id="51">51</th><td><i>// ==============================</i></td></tr>
<tr><th id="52">52</th><td><i>// The SQLTransaction is a state machine that executes a series of states / steps.</i></td></tr>
<tr><th id="53">53</th><td><i>//</i></td></tr>
<tr><th id="54">54</th><td><i>// The work of the transaction states are defined in section of 4.3.2 of the</i></td></tr>
<tr><th id="55">55</th><td><i>// webdatabase spec: <a href="http://dev.w3.org/html5/webdatabase/#processing-model">http://dev.w3.org/html5/webdatabase/#processing-model</a></i></td></tr>
<tr><th id="56">56</th><td><i>//</i></td></tr>
<tr><th id="57">57</th><td><i>// the State Transition Graph at a glance:</i></td></tr>
<tr><th id="58">58</th><td><i>// ======================================</i></td></tr>
<tr><th id="59">59</th><td><i>//</i></td></tr>
<tr><th id="60">60</th><td><i>//     Backend                          .   Frontend</i></td></tr>
<tr><th id="61">61</th><td><i>//     (works with SQLiteDatabase)      .   (works with Script)</i></td></tr>
<tr><th id="62">62</th><td><i>//     ===========================      .   ===================</i></td></tr>
<tr><th id="63">63</th><td><i>//                                      .</i></td></tr>
<tr><th id="64">64</th><td><i>//     1. Idle                          .</i></td></tr>
<tr><th id="65">65</th><td><i>//         v                            .</i></td></tr>
<tr><th id="66">66</th><td><i>//     2. AcquireLock                   .</i></td></tr>
<tr><th id="67">67</th><td><i>//         v                            .</i></td></tr>
<tr><th id="68">68</th><td><i>//     3. OpenTransactionAndPreflight ------------------------------------------.</i></td></tr>
<tr><th id="69">69</th><td><i>//         |                            .                                       |</i></td></tr>
<tr><th id="70">70</th><td><i>//         `-------------------------------&gt; 8. DeliverTransactionCallback --.  |</i></td></tr>
<tr><th id="71">71</th><td><i>//                                      .        |                           v  v</i></td></tr>
<tr><th id="72">72</th><td><i>//         ,-------------------------------------'   9. DeliverTransactionErrorCallback +</i></td></tr>
<tr><th id="73">73</th><td><i>//         |                            .                                    ^  ^  ^    |</i></td></tr>
<tr><th id="74">74</th><td><i>//         v                            .                                    |  |  |    |</i></td></tr>
<tr><th id="75">75</th><td><i>//     4. RunStatements -----------------------------------------------------'  |  |    |</i></td></tr>
<tr><th id="76">76</th><td><i>//         |        ^  ^ |  ^ |         .                                       |  |    |</i></td></tr>
<tr><th id="77">77</th><td><i>//         |--------'  | |  | `------------&gt; 10. DeliverStatementCallback +-----'  |    |</i></td></tr>
<tr><th id="78">78</th><td><i>//         |           | |  `---------------------------------------------'        |    |</i></td></tr>
<tr><th id="79">79</th><td><i>//         |           | `-----------------&gt; 11. DeliverQuotaIncreaseCallback +    |    |</i></td></tr>
<tr><th id="80">80</th><td><i>//         |            `-----------------------------------------------------'    |    |</i></td></tr>
<tr><th id="81">81</th><td><i>//         v                            .                                          |    |</i></td></tr>
<tr><th id="82">82</th><td><i>//     5. PostflightAndCommit --+--------------------------------------------------'    |</i></td></tr>
<tr><th id="83">83</th><td><i>//                              |----------&gt; 12. DeliverSuccessCallback +               |</i></td></tr>
<tr><th id="84">84</th><td><i>//         ,--------------------'       .                               |               |</i></td></tr>
<tr><th id="85">85</th><td><i>//         v                            .                               |               |</i></td></tr>
<tr><th id="86">86</th><td><i>//     6. CleanupAndTerminate &lt;-----------------------------------------'               |</i></td></tr>
<tr><th id="87">87</th><td><i>//         v           ^                .                                               |</i></td></tr>
<tr><th id="88">88</th><td><i>//     0. End          |                .                                               |</i></td></tr>
<tr><th id="89">89</th><td><i>//                     |                .                                               |</i></td></tr>
<tr><th id="90">90</th><td><i>//                7: CleanupAfterTransactionErrorCallback &lt;----------------------------'</i></td></tr>
<tr><th id="91">91</th><td><i>//                                      .</i></td></tr>
<tr><th id="92">92</th><td><i>//</i></td></tr>
<tr><th id="93">93</th><td><i>// the States and State Transitions:</i></td></tr>
<tr><th id="94">94</th><td><i>// ================================</i></td></tr>
<tr><th id="95">95</th><td><i>//     0. SQLTransactionState::End</i></td></tr>
<tr><th id="96">96</th><td><i>//         - the end state.</i></td></tr>
<tr><th id="97">97</th><td><i>//</i></td></tr>
<tr><th id="98">98</th><td><i>//     1. SQLTransactionState::Idle</i></td></tr>
<tr><th id="99">99</th><td><i>//         - placeholder state while waiting on frontend/backend, etc. See comment on</i></td></tr>
<tr><th id="100">100</th><td><i>//           "State transitions between SQLTransaction and SQLTransactionBackend"</i></td></tr>
<tr><th id="101">101</th><td><i>//           below.</i></td></tr>
<tr><th id="102">102</th><td><i>//</i></td></tr>
<tr><th id="103">103</th><td><i>//     2. SQLTransactionState::AcquireLock (runs in backend)</i></td></tr>
<tr><th id="104">104</th><td><i>//         - this is the start state.</i></td></tr>
<tr><th id="105">105</th><td><i>//         - acquire the "lock".</i></td></tr>
<tr><th id="106">106</th><td><i>//         - on "lock" acquisition, goto SQLTransactionState::OpenTransactionAndPreflight.</i></td></tr>
<tr><th id="107">107</th><td><i>//</i></td></tr>
<tr><th id="108">108</th><td><i>//     3. SQLTransactionState::openTransactionAndPreflight (runs in backend)</i></td></tr>
<tr><th id="109">109</th><td><i>//         - Sets up an SQLiteTransaction.</i></td></tr>
<tr><th id="110">110</th><td><i>//         - begin the SQLiteTransaction.</i></td></tr>
<tr><th id="111">111</th><td><i>//         - call the SQLTransactionWrapper preflight if available.</i></td></tr>
<tr><th id="112">112</th><td><i>//         - schedule script callback.</i></td></tr>
<tr><th id="113">113</th><td><i>//         - on error, goto SQLTransactionState::DeliverTransactionErrorCallback.</i></td></tr>
<tr><th id="114">114</th><td><i>//         - goto SQLTransactionState::DeliverTransactionCallback.</i></td></tr>
<tr><th id="115">115</th><td><i>//</i></td></tr>
<tr><th id="116">116</th><td><i>//     4. SQLTransactionState::DeliverTransactionCallback (runs in frontend)</i></td></tr>
<tr><th id="117">117</th><td><i>//         - invoke the script function callback() if available.</i></td></tr>
<tr><th id="118">118</th><td><i>//         - on error, goto SQLTransactionState::DeliverTransactionErrorCallback.</i></td></tr>
<tr><th id="119">119</th><td><i>//         - goto SQLTransactionState::RunStatements.</i></td></tr>
<tr><th id="120">120</th><td><i>//</i></td></tr>
<tr><th id="121">121</th><td><i>//     5. SQLTransactionState::DeliverTransactionErrorCallback (runs in frontend)</i></td></tr>
<tr><th id="122">122</th><td><i>//         - invoke the script function errorCallback if available.</i></td></tr>
<tr><th id="123">123</th><td><i>//         - goto SQLTransactionState::CleanupAfterTransactionErrorCallback.</i></td></tr>
<tr><th id="124">124</th><td><i>//</i></td></tr>
<tr><th id="125">125</th><td><i>//     6. SQLTransactionState::RunStatements (runs in backend)</i></td></tr>
<tr><th id="126">126</th><td><i>//         - while there are statements {</i></td></tr>
<tr><th id="127">127</th><td><i>//             - run a statement.</i></td></tr>
<tr><th id="128">128</th><td><i>//             - if statementCallback is available, goto SQLTransactionState::DeliverStatementCallback.</i></td></tr>
<tr><th id="129">129</th><td><i>//             - on error,</i></td></tr>
<tr><th id="130">130</th><td><i>//               goto SQLTransactionState::DeliverQuotaIncreaseCallback, or</i></td></tr>
<tr><th id="131">131</th><td><i>//               goto SQLTransactionState::DeliverStatementCallback, or</i></td></tr>
<tr><th id="132">132</th><td><i>//               goto SQLTransactionState::deliverTransactionErrorCallback.</i></td></tr>
<tr><th id="133">133</th><td><i>//           }</i></td></tr>
<tr><th id="134">134</th><td><i>//         - goto SQLTransactionState::PostflightAndCommit.</i></td></tr>
<tr><th id="135">135</th><td><i>//</i></td></tr>
<tr><th id="136">136</th><td><i>//     7. SQLTransactionState::DeliverStatementCallback (runs in frontend)</i></td></tr>
<tr><th id="137">137</th><td><i>//         - invoke script statement callback (assume available).</i></td></tr>
<tr><th id="138">138</th><td><i>//         - on error, goto SQLTransactionState::DeliverTransactionErrorCallback.</i></td></tr>
<tr><th id="139">139</th><td><i>//         - goto SQLTransactionState::RunStatements.</i></td></tr>
<tr><th id="140">140</th><td><i>//</i></td></tr>
<tr><th id="141">141</th><td><i>//     8. SQLTransactionState::DeliverQuotaIncreaseCallback (runs in frontend)</i></td></tr>
<tr><th id="142">142</th><td><i>//         - give client a chance to increase the quota.</i></td></tr>
<tr><th id="143">143</th><td><i>//         - goto SQLTransactionState::RunStatements.</i></td></tr>
<tr><th id="144">144</th><td><i>//</i></td></tr>
<tr><th id="145">145</th><td><i>//     9. SQLTransactionState::PostflightAndCommit (runs in backend)</i></td></tr>
<tr><th id="146">146</th><td><i>//         - call the SQLTransactionWrapper postflight if available.</i></td></tr>
<tr><th id="147">147</th><td><i>//         - commit the SQLiteTansaction.</i></td></tr>
<tr><th id="148">148</th><td><i>//         - on error, goto SQLTransactionState::DeliverTransactionErrorCallback.</i></td></tr>
<tr><th id="149">149</th><td><i>//         - if successCallback is available, goto SQLTransactionState::DeliverSuccessCallback.</i></td></tr>
<tr><th id="150">150</th><td><i>//           else goto SQLTransactionState::CleanupAndTerminate.</i></td></tr>
<tr><th id="151">151</th><td><i>//</i></td></tr>
<tr><th id="152">152</th><td><i>//     10. SQLTransactionState::DeliverSuccessCallback (runs in frontend)</i></td></tr>
<tr><th id="153">153</th><td><i>//         - invoke the script function successCallback() if available.</i></td></tr>
<tr><th id="154">154</th><td><i>//         - goto SQLTransactionState::CleanupAndTerminate.</i></td></tr>
<tr><th id="155">155</th><td><i>//</i></td></tr>
<tr><th id="156">156</th><td><i>//     11. SQLTransactionState::CleanupAndTerminate (runs in backend)</i></td></tr>
<tr><th id="157">157</th><td><i>//         - stop and clear the SQLiteTransaction.</i></td></tr>
<tr><th id="158">158</th><td><i>//         - release the "lock".</i></td></tr>
<tr><th id="159">159</th><td><i>//         - goto SQLTransactionState::End.</i></td></tr>
<tr><th id="160">160</th><td><i>//</i></td></tr>
<tr><th id="161">161</th><td><i>//     12. SQLTransactionState::CleanupAfterTransactionErrorCallback (runs in backend)</i></td></tr>
<tr><th id="162">162</th><td><i>//         - rollback the SQLiteTransaction.</i></td></tr>
<tr><th id="163">163</th><td><i>//         - goto SQLTransactionState::CleanupAndTerminate.</i></td></tr>
<tr><th id="164">164</th><td><i>//</i></td></tr>
<tr><th id="165">165</th><td><i>// State transitions between SQLTransaction and SQLTransactionBackend</i></td></tr>
<tr><th id="166">166</th><td><i>// ==================================================================</i></td></tr>
<tr><th id="167">167</th><td><i>// As shown above, there are state transitions that crosses the boundary between</i></td></tr>
<tr><th id="168">168</th><td><i>// the frontend and backend. For example,</i></td></tr>
<tr><th id="169">169</th><td><i>//</i></td></tr>
<tr><th id="170">170</th><td><i>//     OpenTransactionAndPreflight (state 3 in the backend)</i></td></tr>
<tr><th id="171">171</th><td><i>//     transitions to DeliverTransactionCallback (state 8 in the frontend),</i></td></tr>
<tr><th id="172">172</th><td><i>//     which in turn transitions to RunStatements (state 4 in the backend).</i></td></tr>
<tr><th id="173">173</th><td><i>//</i></td></tr>
<tr><th id="174">174</th><td><i>// This cross boundary transition is done by posting transition requests to the</i></td></tr>
<tr><th id="175">175</th><td><i>// other side and letting the other side's state machine execute the state</i></td></tr>
<tr><th id="176">176</th><td><i>// transition in the appropriate thread (i.e. the script thread for the frontend,</i></td></tr>
<tr><th id="177">177</th><td><i>// and the database thread for the backend).</i></td></tr>
<tr><th id="178">178</th><td><i>//</i></td></tr>
<tr><th id="179">179</th><td><i>// Logically, the state transitions work as shown in the graph above. But</i></td></tr>
<tr><th id="180">180</th><td><i>// physically, the transition mechanism uses the Idle state (both in the frontend</i></td></tr>
<tr><th id="181">181</th><td><i>// and backend) as a waiting state for further activity. For example, taking a</i></td></tr>
<tr><th id="182">182</th><td><i>// closer look at the 3 state transition example above, what actually happens</i></td></tr>
<tr><th id="183">183</th><td><i>// is as follows:</i></td></tr>
<tr><th id="184">184</th><td><i>//</i></td></tr>
<tr><th id="185">185</th><td><i>//     Step 1:</i></td></tr>
<tr><th id="186">186</th><td><i>//     ======</i></td></tr>
<tr><th id="187">187</th><td><i>//     In the frontend thread:</i></td></tr>
<tr><th id="188">188</th><td><i>//     - waiting quietly is Idle. Not doing any work.</i></td></tr>
<tr><th id="189">189</th><td><i>//</i></td></tr>
<tr><th id="190">190</th><td><i>//     In the backend:</i></td></tr>
<tr><th id="191">191</th><td><i>//     - is in OpenTransactionAndPreflight, and doing its work.</i></td></tr>
<tr><th id="192">192</th><td><i>//     - when done, it transits to the backend DeliverTransactionCallback.</i></td></tr>
<tr><th id="193">193</th><td><i>//     - the backend DeliverTransactionCallback sends a request to the frontend</i></td></tr>
<tr><th id="194">194</th><td><i>//       to transit to DeliverTransactionCallback, and then itself transits to</i></td></tr>
<tr><th id="195">195</th><td><i>//       Idle.</i></td></tr>
<tr><th id="196">196</th><td><i>//</i></td></tr>
<tr><th id="197">197</th><td><i>//     Step 2:</i></td></tr>
<tr><th id="198">198</th><td><i>//     ======</i></td></tr>
<tr><th id="199">199</th><td><i>//     In the frontend thread:</i></td></tr>
<tr><th id="200">200</th><td><i>//     - transits to DeliverTransactionCallback and does its work.</i></td></tr>
<tr><th id="201">201</th><td><i>//     - when done, it transits to the frontend RunStatements.</i></td></tr>
<tr><th id="202">202</th><td><i>//     - the frontend RunStatements sends a request to the backend to transit</i></td></tr>
<tr><th id="203">203</th><td><i>//       to RunStatements, and then itself transits to Idle.</i></td></tr>
<tr><th id="204">204</th><td><i>//</i></td></tr>
<tr><th id="205">205</th><td><i>//     In the backend:</i></td></tr>
<tr><th id="206">206</th><td><i>//     - waiting quietly in Idle.</i></td></tr>
<tr><th id="207">207</th><td><i>//</i></td></tr>
<tr><th id="208">208</th><td><i>//     Step 3:</i></td></tr>
<tr><th id="209">209</th><td><i>//     ======</i></td></tr>
<tr><th id="210">210</th><td><i>//     In the frontend thread:</i></td></tr>
<tr><th id="211">211</th><td><i>//     - waiting quietly is Idle. Not doing any work.</i></td></tr>
<tr><th id="212">212</th><td><i>//</i></td></tr>
<tr><th id="213">213</th><td><i>//     In the backend:</i></td></tr>
<tr><th id="214">214</th><td><i>//     - transits to RunStatements, and does its work.</i></td></tr>
<tr><th id="215">215</th><td><i>//        ...</i></td></tr>
<tr><th id="216">216</th><td><i>//</i></td></tr>
<tr><th id="217">217</th><td><i>// So, when the frontend or backend are not active, they will park themselves in</i></td></tr>
<tr><th id="218">218</th><td><i>// their Idle states. This means their m_nextState is set to Idle, but they never</i></td></tr>
<tr><th id="219">219</th><td><i>// actually run the corresponding state function. Note: for both the frontend and</i></td></tr>
<tr><th id="220">220</th><td><i>// backend, the state function for Idle is unreachableState().</i></td></tr>
<tr><th id="221">221</th><td><i>//</i></td></tr>
<tr><th id="222">222</th><td><i>// The states that send a request to their peer across the front/back boundary</i></td></tr>
<tr><th id="223">223</th><td><i>// are implemented with just 2 functions: SQLTransaction::sendToBackendState()</i></td></tr>
<tr><th id="224">224</th><td><i>// and SQLTransactionBackend::sendToFrontendState(). These state functions do</i></td></tr>
<tr><th id="225">225</th><td><i>// nothing but sends a request to the other side to transit to the current</i></td></tr>
<tr><th id="226">226</th><td><i>// state (indicated by m_nextState), and then transits itself to the Idle state</i></td></tr>
<tr><th id="227">227</th><td><i>// to wait for further action.</i></td></tr>
<tr><th id="228">228</th><td><i></i></td></tr>
<tr><th id="229">229</th><td><i></i></td></tr>
<tr><th id="230">230</th><td><i>// The Life-Cycle of a SQLTransaction i.e. Who's keeping the SQLTransaction alive? </i></td></tr>
<tr><th id="231">231</th><td><i>// ==============================================================================</i></td></tr>
<tr><th id="232">232</th><td><i>// The RefPtr chain goes something like this:</i></td></tr>
<tr><th id="233">233</th><td><i>//</i></td></tr>
<tr><th id="234">234</th><td><i>//     At birth (in DatabaseBackend::runTransaction()):</i></td></tr>
<tr><th id="235">235</th><td><i>//     ====================================================</i></td></tr>
<tr><th id="236">236</th><td><i>//     DatabaseBackend                    // Deque&lt;RefPtr&lt;SQLTransactionBackend&gt;&gt; m_transactionQueue points to ...</i></td></tr>
<tr><th id="237">237</th><td><i>//     --&gt; SQLTransactionBackend          // RefPtr&lt;SQLTransaction&gt; m_frontend points to ...</i></td></tr>
<tr><th id="238">238</th><td><i>//         --&gt; SQLTransaction             // RefPtr&lt;SQLTransactionBackend&gt; m_backend points to ...</i></td></tr>
<tr><th id="239">239</th><td><i>//             --&gt; SQLTransactionBackend  // which is a circular reference.</i></td></tr>
<tr><th id="240">240</th><td><i>//</i></td></tr>
<tr><th id="241">241</th><td><i>//     Note: there's a circular reference between the SQLTransaction front-end and</i></td></tr>
<tr><th id="242">242</th><td><i>//     back-end. This circular reference is established in the constructor of the</i></td></tr>
<tr><th id="243">243</th><td><i>//     SQLTransactionBackend. The circular reference will be broken by calling</i></td></tr>
<tr><th id="244">244</th><td><i>//     doCleanup() to nullify m_frontend. This is done at the end of the transaction's</i></td></tr>
<tr><th id="245">245</th><td><i>//     clean up state (i.e. when the transaction should no longer be in use thereafter),</i></td></tr>
<tr><th id="246">246</th><td><i>//     or if the database was interrupted. See comments on "What happens if a transaction</i></td></tr>
<tr><th id="247">247</th><td><i>//     is interrupted?" below for details.</i></td></tr>
<tr><th id="248">248</th><td><i>//</i></td></tr>
<tr><th id="249">249</th><td><i>//     After scheduling the transaction with the DatabaseThread (DatabaseBackend::scheduleTransaction()):</i></td></tr>
<tr><th id="250">250</th><td><i>//     ======================================================================================================</i></td></tr>
<tr><th id="251">251</th><td><i>//     DatabaseThread                         // MessageQueue&lt;DatabaseTask&gt; m_queue points to ...</i></td></tr>
<tr><th id="252">252</th><td><i>//     --&gt; DatabaseTransactionTask            // RefPtr&lt;SQLTransactionBackend&gt; m_transaction points to ...</i></td></tr>
<tr><th id="253">253</th><td><i>//         --&gt; SQLTransactionBackend          // RefPtr&lt;SQLTransaction&gt; m_frontend points to ...</i></td></tr>
<tr><th id="254">254</th><td><i>//             --&gt; SQLTransaction             // RefPtr&lt;SQLTransactionBackend&gt; m_backend points to ...</i></td></tr>
<tr><th id="255">255</th><td><i>//                 --&gt; SQLTransactionBackend  // which is a circular reference.</i></td></tr>
<tr><th id="256">256</th><td><i>//</i></td></tr>
<tr><th id="257">257</th><td><i>//     When executing the transaction (in DatabaseThread::databaseThread()):</i></td></tr>
<tr><th id="258">258</th><td><i>//     ====================================================================</i></td></tr>
<tr><th id="259">259</th><td><i>//     std::unique_ptr&lt;DatabaseTask&gt; task;    // points to ...</i></td></tr>
<tr><th id="260">260</th><td><i>//     --&gt; DatabaseTransactionTask            // RefPtr&lt;SQLTransactionBackend&gt; m_transaction points to ...</i></td></tr>
<tr><th id="261">261</th><td><i>//         --&gt; SQLTransactionBackend          // RefPtr&lt;SQLTransaction&gt; m_frontend;</i></td></tr>
<tr><th id="262">262</th><td><i>//             --&gt; SQLTransaction             // RefPtr&lt;SQLTransactionBackend&gt; m_backend points to ...</i></td></tr>
<tr><th id="263">263</th><td><i>//                 --&gt; SQLTransactionBackend  // which is a circular reference.</i></td></tr>
<tr><th id="264">264</th><td><i>//</i></td></tr>
<tr><th id="265">265</th><td><i>//     At the end of cleanupAndTerminate():</i></td></tr>
<tr><th id="266">266</th><td><i>//     ===================================</i></td></tr>
<tr><th id="267">267</th><td><i>//     At the end of the cleanup state, the SQLTransactionBackend::m_frontend is nullified.</i></td></tr>
<tr><th id="268">268</th><td><i>//     If by then, a JSObject wrapper is referring to the SQLTransaction, then the reference</i></td></tr>
<tr><th id="269">269</th><td><i>//     chain looks like this:</i></td></tr>
<tr><th id="270">270</th><td><i>//</i></td></tr>
<tr><th id="271">271</th><td><i>//     JSObjectWrapper</i></td></tr>
<tr><th id="272">272</th><td><i>//     --&gt; SQLTransaction             // in RefPtr&lt;SQLTransactionBackend&gt; m_backend points to ...</i></td></tr>
<tr><th id="273">273</th><td><i>//         --&gt; SQLTransactionBackend  // which no longer points back to its SQLTransaction.</i></td></tr>
<tr><th id="274">274</th><td><i>//</i></td></tr>
<tr><th id="275">275</th><td><i>//     When the GC collects the corresponding JSObject, the above chain will be cleaned up</i></td></tr>
<tr><th id="276">276</th><td><i>//     and deleted.</i></td></tr>
<tr><th id="277">277</th><td><i>//</i></td></tr>
<tr><th id="278">278</th><td><i>//     If there is no JSObject wrapper referring to the SQLTransaction when the cleanup</i></td></tr>
<tr><th id="279">279</th><td><i>//     states nullify SQLTransactionBackend::m_frontend, the SQLTransaction will deleted then.</i></td></tr>
<tr><th id="280">280</th><td><i>//     However, there will still be a DatabaseTask pointing to the SQLTransactionBackend (see</i></td></tr>
<tr><th id="281">281</th><td><i>//     the "When executing the transaction" chain above). This will keep the</i></td></tr>
<tr><th id="282">282</th><td><i>//     SQLTransactionBackend alive until DatabaseThread::databaseThread() releases its</i></td></tr>
<tr><th id="283">283</th><td><i>//     task std::unique_ptr.</i></td></tr>
<tr><th id="284">284</th><td><i>//</i></td></tr>
<tr><th id="285">285</th><td><i>//     What happens if a transaction is interrupted?</i></td></tr>
<tr><th id="286">286</th><td><i>//     ============================================</i></td></tr>
<tr><th id="287">287</th><td><i>//     If the transaction is interrupted half way, it won't get to run to state</i></td></tr>
<tr><th id="288">288</th><td><i>//     CleanupAndTerminate, and hence, would not have called SQLTransactionBackend's</i></td></tr>
<tr><th id="289">289</th><td><i>//     doCleanup(). doCleanup() is where we nullify SQLTransactionBackend::m_frontend</i></td></tr>
<tr><th id="290">290</th><td><i>//     to break the reference cycle between the frontend and backend. Hence, we need</i></td></tr>
<tr><th id="291">291</th><td><i>//     to cleanup the transaction by other means.</i></td></tr>
<tr><th id="292">292</th><td><i>//</i></td></tr>
<tr><th id="293">293</th><td><i>//     Note: calling SQLTransactionBackend::notifyDatabaseThreadIsShuttingDown()</i></td></tr>
<tr><th id="294">294</th><td><i>//     is effectively the same as calling SQLTransactionBackend::doClean().</i></td></tr>
<tr><th id="295">295</th><td><i>//</i></td></tr>
<tr><th id="296">296</th><td><i>//     In terms of who needs to call doCleanup(), there are 5 phases in the</i></td></tr>
<tr><th id="297">297</th><td><i>//     SQLTransactionBackend life-cycle. These are the phases and how the clean</i></td></tr>
<tr><th id="298">298</th><td><i>//     up is done:</i></td></tr>
<tr><th id="299">299</th><td><i>//</i></td></tr>
<tr><th id="300">300</th><td><i>//     Phase 1. After Birth, before scheduling</i></td></tr>
<tr><th id="301">301</th><td><i>//</i></td></tr>
<tr><th id="302">302</th><td><i>//     - To clean up, DatabaseThread::databaseThread() will call</i></td></tr>
<tr><th id="303">303</th><td><i>//       DatabaseBackend::close() during its shutdown.</i></td></tr>
<tr><th id="304">304</th><td><i>//     - DatabaseBackend::close() will iterate</i></td></tr>
<tr><th id="305">305</th><td><i>//       DatabaseBackend::m_transactionQueue and call</i></td></tr>
<tr><th id="306">306</th><td><i>//       notifyDatabaseThreadIsShuttingDown() on each transaction there.</i></td></tr>
<tr><th id="307">307</th><td><i>//        </i></td></tr>
<tr><th id="308">308</th><td><i>//     Phase 2. After scheduling, before state AcquireLock</i></td></tr>
<tr><th id="309">309</th><td><i>//</i></td></tr>
<tr><th id="310">310</th><td><i>//     - If the interruption occures before the DatabaseTransactionTask is</i></td></tr>
<tr><th id="311">311</th><td><i>//       scheduled in DatabaseThread::m_queue but hasn't gotten to execute</i></td></tr>
<tr><th id="312">312</th><td><i>//       (i.e. DatabaseTransactionTask::performTask() has not been called),</i></td></tr>
<tr><th id="313">313</th><td><i>//       then the DatabaseTransactionTask may get destructed before it ever</i></td></tr>
<tr><th id="314">314</th><td><i>//       gets to execute.</i></td></tr>
<tr><th id="315">315</th><td><i>//     - To clean up, the destructor will check if the task's m_wasExecuted is</i></td></tr>
<tr><th id="316">316</th><td><i>//       set. If not, it will call notifyDatabaseThreadIsShuttingDown() on</i></td></tr>
<tr><th id="317">317</th><td><i>//       the task's transaction.</i></td></tr>
<tr><th id="318">318</th><td><i>//</i></td></tr>
<tr><th id="319">319</th><td><i>//     Phase 3. After state AcquireLock, before "lockAcquired"</i></td></tr>
<tr><th id="320">320</th><td><i>//</i></td></tr>
<tr><th id="321">321</th><td><i>//     - In this phase, the transaction would have been added to the</i></td></tr>
<tr><th id="322">322</th><td><i>//       SQLTransactionCoordinator's CoordinationInfo's pendingTransactions.</i></td></tr>
<tr><th id="323">323</th><td><i>//     - To clean up, during shutdown, DatabaseThread::databaseThread() calls</i></td></tr>
<tr><th id="324">324</th><td><i>//       SQLTransactionCoordinator::shutdown(), which calls</i></td></tr>
<tr><th id="325">325</th><td><i>//       notifyDatabaseThreadIsShuttingDown().</i></td></tr>
<tr><th id="326">326</th><td><i>//</i></td></tr>
<tr><th id="327">327</th><td><i>//     Phase 4: After "lockAcquired", before state CleanupAndTerminate</i></td></tr>
<tr><th id="328">328</th><td><i>//</i></td></tr>
<tr><th id="329">329</th><td><i>//     - In this phase, the transaction would have been added either to the</i></td></tr>
<tr><th id="330">330</th><td><i>//       SQLTransactionCoordinator's CoordinationInfo's activeWriteTransaction</i></td></tr>
<tr><th id="331">331</th><td><i>//       or activeReadTransactions.</i></td></tr>
<tr><th id="332">332</th><td><i>//     - To clean up, during shutdown, DatabaseThread::databaseThread() calls</i></td></tr>
<tr><th id="333">333</th><td><i>//       SQLTransactionCoordinator::shutdown(), which calls</i></td></tr>
<tr><th id="334">334</th><td><i>//       notifyDatabaseThreadIsShuttingDown().</i></td></tr>
<tr><th id="335">335</th><td><i>//</i></td></tr>
<tr><th id="336">336</th><td><i>//     Phase 5: After state CleanupAndTerminate</i></td></tr>
<tr><th id="337">337</th><td><i>//</i></td></tr>
<tr><th id="338">338</th><td><i>//     - This is how a transaction ends normally.</i></td></tr>
<tr><th id="339">339</th><td><i>//     - state CleanupAndTerminate calls doCleanup().</i></td></tr>
<tr><th id="340">340</th><td></td></tr>
<tr><th id="341">341</th><td><b>namespace</b> <span class="namespace">WebCore</span> {</td></tr>
<tr><th id="342">342</th><td></td></tr>
<tr><th id="343">343</th><td><a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackendC1ERNS_14SQLTransactionE" title='WebCore::SQLTransactionBackend::SQLTransactionBackend' data-ref="_ZN7WebCore21SQLTransactionBackendC1ERNS_14SQLTransactionE" data-ref-filename="_ZN7WebCore21SQLTransactionBackendC1ERNS_14SQLTransactionE">SQLTransactionBackend</dfn>(<a class="type" href="SQLTransaction.h.html#WebCore::SQLTransaction" title='WebCore::SQLTransaction' data-ref="WebCore::SQLTransaction" data-ref-filename="WebCore..SQLTransaction">SQLTransaction</a>&amp; <dfn class="local col9 decl" id="69frontend" title='frontend' data-type='WebCore::SQLTransaction &amp;' data-ref="69frontend" data-ref-filename="69frontend">frontend</dfn>)</td></tr>
<tr><th id="344">344</th><td>    : <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>(<a class="local col9 ref" href="#69frontend" title='frontend' data-ref="69frontend" data-ref-filename="69frontend">frontend</a>)</td></tr>
<tr><th id="345">345</th><td>{</td></tr>
<tr><th id="346">346</th><td>    <a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_requestedState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_requestedState' data-ref="WebCore::SQLTransactionStateMachine::m_requestedState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_requestedState">m_requestedState</a> = <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::AcquireLock" title='WebCore::SQLTransactionState::AcquireLock' data-ref="WebCore::SQLTransactionState::AcquireLock" data-ref-filename="WebCore..SQLTransactionState..AcquireLock">AcquireLock</a>;</td></tr>
<tr><th id="347">347</th><td>}</td></tr>
<tr><th id="348">348</th><td></td></tr>
<tr><th id="349">349</th><td><a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="virtual decl def fn" id="_ZN7WebCore21SQLTransactionBackendD1Ev" title='WebCore::SQLTransactionBackend::~SQLTransactionBackend' data-ref="_ZN7WebCore21SQLTransactionBackendD1Ev" data-ref-filename="_ZN7WebCore21SQLTransactionBackendD1Ev">~SQLTransactionBackend</dfn>()</td></tr>
<tr><th id="350">350</th><td>{</td></tr>
<tr><th id="351">351</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#347" title="do { if (!(!m_frontend.m_sqliteTransaction)) { WTFReportAssertionFailure(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, 351, __PRETTY_FUNCTION__, &quot;!m_frontend.m_sqliteTransaction&quot;); do { WTF::isIntegralOrPointerType(); compilerFenceForCrash(); WTFCrashWithInfo(351, &quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, __PRETTY_FUNCTION__, 660); } while (false); } } while (0)" data-ref="_M/ASSERT">ASSERT</a>(!<span class='ref fn fake' title='std::__1::unique_ptr::operator bool' data-ref="_ZNKSt3__110unique_ptrcvbEv" data-ref-filename="_ZNKSt3__110unique_ptrcvbEv"></span><a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_sqliteTransaction" title='WebCore::SQLTransaction::m_sqliteTransaction' data-ref="WebCore::SQLTransaction::m_sqliteTransaction" data-ref-filename="WebCore..SQLTransaction..m_sqliteTransaction">m_sqliteTransaction</a>);</td></tr>
<tr><th id="352">352</th><td>}</td></tr>
<tr><th id="353">353</th><td></td></tr>
<tr><th id="354">354</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend9doCleanupEv" title='WebCore::SQLTransactionBackend::doCleanup' data-ref="_ZN7WebCore21SQLTransactionBackend9doCleanupEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend9doCleanupEv">doCleanup</dfn>()</td></tr>
<tr><th id="355">355</th><td>{</td></tr>
<tr><th id="356">356</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#347" title="do { if (!(m_frontend.database().databaseThread().getThread() == &amp;Thread::current())) { WTFReportAssertionFailure(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, 356, __PRETTY_FUNCTION__, &quot;m_frontend.database().databaseThread().getThread() == &amp;Thread::current()&quot;); do { WTF::isIntegralOrPointerType(); compilerFenceForCrash(); WTFCrashWithInfo(356, &quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, __PRETTY_FUNCTION__, 662); } while (false); } } while (0)" data-ref="_M/ASSERT">ASSERT</a>(<a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.h.html#_ZN7WebCore14SQLTransaction8databaseEv" title='WebCore::SQLTransaction::database' data-ref="_ZN7WebCore14SQLTransaction8databaseEv" data-ref-filename="_ZN7WebCore14SQLTransaction8databaseEv">database</a>().<a class="ref fn" href="Database.h.html#_ZN7WebCore8Database14databaseThreadEv" title='WebCore::Database::databaseThread' data-ref="_ZN7WebCore8Database14databaseThreadEv" data-ref-filename="_ZN7WebCore8Database14databaseThreadEv">databaseThread</a>().<a class="ref fn" href="DatabaseThread.h.html#_ZN7WebCore14DatabaseThread9getThreadEv" title='WebCore::DatabaseThread::getThread' data-ref="_ZN7WebCore14DatabaseThread9getThreadEv" data-ref-filename="_ZN7WebCore14DatabaseThread9getThreadEv">getThread</a>() == &amp;<a class="type" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Threading.h.html#WTF::Thread" title='WTF::Thread' data-ref="WTF::Thread" data-ref-filename="WTF..Thread">Thread</a>::<a class="ref fn" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Threading.h.html#_ZN3WTF6Thread7currentEv" title='WTF::Thread::current' data-ref="_ZN3WTF6Thread7currentEv" data-ref-filename="_ZN3WTF6Thread7currentEv">current</a>());</td></tr>
<tr><th id="357">357</th><td></td></tr>
<tr><th id="358">358</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.cpp.html#_ZN7WebCore14SQLTransaction25releaseOriginLockIfNeededEv" title='WebCore::SQLTransaction::releaseOriginLockIfNeeded' data-ref="_ZN7WebCore14SQLTransaction25releaseOriginLockIfNeededEv" data-ref-filename="_ZN7WebCore14SQLTransaction25releaseOriginLockIfNeededEv">releaseOriginLockIfNeeded</a>();</td></tr>
<tr><th id="359">359</th><td></td></tr>
<tr><th id="360">360</th><td>    Locker <dfn class="local col0 decl" id="70locker" title='locker' data-type='WTF::Locker&lt;WTF::Lock&gt;' data-ref="70locker" data-ref-filename="70locker">locker</dfn> <a class="ref fn" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Lock.h.html#_ZN3WTF6LockerINS_4LockEEC1ERS1_" title='WTF::Locker&lt;WTF::Lock&gt;::Locker' data-ref="_ZN3WTF6LockerINS_4LockEEC1ERS1_" data-ref-filename="_ZN3WTF6LockerINS_4LockEEC1ERS1_">{</a> <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_statementLock" title='WebCore::SQLTransaction::m_statementLock' data-ref="WebCore::SQLTransaction::m_statementLock" data-ref-filename="WebCore..SQLTransaction..m_statementLock">m_statementLock</a> };</td></tr>
<tr><th id="361">361</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_statementQueue" title='WebCore::SQLTransaction::m_statementQueue' data-ref="WebCore::SQLTransaction::m_statementQueue" data-ref-filename="WebCore..SQLTransaction..m_statementQueue">m_statementQueue</a>.<a class="ref fn" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Deque.h.html#_ZN3WTF5Deque5clearEv" title='WTF::Deque::clear' data-ref="_ZN3WTF5Deque5clearEv" data-ref-filename="_ZN3WTF5Deque5clearEv">clear</a>();</td></tr>
<tr><th id="362">362</th><td></td></tr>
<tr><th id="363">363</th><td>    <b>if</b> (<span class='ref fn fake' title='std::__1::unique_ptr::operator bool' data-ref="_ZNKSt3__110unique_ptrcvbEv" data-ref-filename="_ZNKSt3__110unique_ptrcvbEv"></span><a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_sqliteTransaction" title='WebCore::SQLTransaction::m_sqliteTransaction' data-ref="WebCore::SQLTransaction::m_sqliteTransaction" data-ref-filename="WebCore..SQLTransaction..m_sqliteTransaction">m_sqliteTransaction</a>) {</td></tr>
<tr><th id="364">364</th><td>        <i>// In the event we got here because of an interruption or error (i.e. if</i></td></tr>
<tr><th id="365">365</th><td><i>        // the transaction is in progress), we should roll it back here. Clearing</i></td></tr>
<tr><th id="366">366</th><td><i>        // m_sqliteTransaction invokes SQLiteTransaction's destructor which does</i></td></tr>
<tr><th id="367">367</th><td><i>        // just that. We might as well do this unconditionally and free up its</i></td></tr>
<tr><th id="368">368</th><td><i>        // resources because we're already terminating.</i></td></tr>
<tr><th id="369">369</th><td>        <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_sqliteTransaction" title='WebCore::SQLTransaction::m_sqliteTransaction' data-ref="WebCore::SQLTransaction::m_sqliteTransaction" data-ref-filename="WebCore..SQLTransaction..m_sqliteTransaction">m_sqliteTransaction</a> <span class='ref fn' title='std::__1::unique_ptr::operator=' data-ref="_ZNSt3__110unique_ptraSEDn" data-ref-filename="_ZNSt3__110unique_ptraSEDn">=</span> <b>nullptr</b>;</td></tr>
<tr><th id="370">370</th><td>    }</td></tr>
<tr><th id="371">371</th><td></td></tr>
<tr><th id="372">372</th><td>    <i>// Release the lock on this database</i></td></tr>
<tr><th id="373">373</th><td>    <b>if</b> (<a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_lockAcquired" title='WebCore::SQLTransaction::m_lockAcquired' data-ref="WebCore::SQLTransaction::m_lockAcquired" data-ref-filename="WebCore..SQLTransaction..m_lockAcquired">m_lockAcquired</a>)</td></tr>
<tr><th id="374">374</th><td>        <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_database" title='WebCore::SQLTransaction::m_database' data-ref="WebCore::SQLTransaction::m_database" data-ref-filename="WebCore..SQLTransaction..m_database">m_database</a><a class="ref fn" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Ref.h.html#_ZNK3WTF3RefptEv" title='WTF::Ref::operator-&gt;' data-ref="_ZNK3WTF3RefptEv" data-ref-filename="_ZNK3WTF3RefptEv">-&gt;</a><a class="ref fn" href="Database.h.html#_ZN7WebCore8Database22transactionCoordinatorEv" title='WebCore::Database::transactionCoordinator' data-ref="_ZN7WebCore8Database22transactionCoordinatorEv" data-ref-filename="_ZN7WebCore8Database22transactionCoordinatorEv">transactionCoordinator</a>()-&gt;<a class="ref fn" href="SQLTransactionCoordinator.cpp.html#_ZN7WebCore25SQLTransactionCoordinator11releaseLockERNS_14SQLTransactionE" title='WebCore::SQLTransactionCoordinator::releaseLock' data-ref="_ZN7WebCore25SQLTransactionCoordinator11releaseLockERNS_14SQLTransactionE" data-ref-filename="_ZN7WebCore25SQLTransactionCoordinator11releaseLockERNS_14SQLTransactionE">releaseLock</a>(<span class='refarg'><a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a></span>);</td></tr>
<tr><th id="375">375</th><td></td></tr>
<tr><th id="376">376</th><td>    <i>// Do some aggresive clean up here except for m_database.</i></td></tr>
<tr><th id="377">377</th><td><i>    //</i></td></tr>
<tr><th id="378">378</th><td><i>    // We can't clear m_database here because the frontend may asynchronously</i></td></tr>
<tr><th id="379">379</th><td><i>    // invoke SQLTransactionBackend::requestTransitToState(), and that function</i></td></tr>
<tr><th id="380">380</th><td><i>    // uses m_database to schedule a state transition. This may occur because</i></td></tr>
<tr><th id="381">381</th><td><i>    // the frontend (being in another thread) may already be on the way to</i></td></tr>
<tr><th id="382">382</th><td><i>    // requesting our next state before it detects an interruption.</i></td></tr>
<tr><th id="383">383</th><td><i>    //</i></td></tr>
<tr><th id="384">384</th><td><i>    // There is no harm in letting it finish making the request. It'll set</i></td></tr>
<tr><th id="385">385</th><td><i>    // m_requestedState, but we won't execute a transition to that state because</i></td></tr>
<tr><th id="386">386</th><td><i>    // we've already shut down the transaction.</i></td></tr>
<tr><th id="387">387</th><td><i>    //</i></td></tr>
<tr><th id="388">388</th><td><i>    // We also can't clear m_currentStatementBackend and m_transactionError.</i></td></tr>
<tr><th id="389">389</th><td><i>    // m_currentStatementBackend may be accessed asynchronously by the</i></td></tr>
<tr><th id="390">390</th><td><i>    // frontend's deliverStatementCallback() state. Similarly,</i></td></tr>
<tr><th id="391">391</th><td><i>    // m_transactionError may be accessed by deliverTransactionErrorCallback().</i></td></tr>
<tr><th id="392">392</th><td><i>    // This occurs if requests for transition to those states have already been</i></td></tr>
<tr><th id="393">393</th><td><i>    // registered with the frontend just prior to a clean up request arriving.</i></td></tr>
<tr><th id="394">394</th><td><i>    //</i></td></tr>
<tr><th id="395">395</th><td><i>    // So instead, let our destructor handle their clean up since this</i></td></tr>
<tr><th id="396">396</th><td><i>    // SQLTransactionBackend is guaranteed to not destruct until the frontend</i></td></tr>
<tr><th id="397">397</th><td><i>    // is also destructing.</i></td></tr>
<tr><th id="398">398</th><td></td></tr>
<tr><th id="399">399</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_wrapper" title='WebCore::SQLTransaction::m_wrapper' data-ref="WebCore::SQLTransaction::m_wrapper" data-ref-filename="WebCore..SQLTransaction..m_wrapper">m_wrapper</a> <a class="ref fn" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/RefPtr.h.html#_ZN3WTF6RefPtraSEDn" title='WTF::RefPtr::operator=' data-ref="_ZN3WTF6RefPtraSEDn" data-ref-filename="_ZN3WTF6RefPtraSEDn">=</a> <b>nullptr</b>;</td></tr>
<tr><th id="400">400</th><td>}</td></tr>
<tr><th id="401">401</th><td></td></tr>
<tr><th id="402">402</th><td><a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="typedef" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine{WebCore::SQLTransactionBackend}::StateFunction" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::StateFunction' data-type='void (WebCore::SQLTransactionBackend::*)()' data-ref="WebCore::SQLTransactionStateMachine{WebCore::SQLTransactionBackend}::StateFunction" data-ref-filename="WebCore..SQLTransactionStateMachine{WebCore..SQLTransactionBackend}..StateFunction">StateFunction</a> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="virtual decl def fn" id="_ZN7WebCore21SQLTransactionBackend16stateFunctionForENS_19SQLTransactionStateE" title='WebCore::SQLTransactionBackend::stateFunctionFor' data-ref="_ZN7WebCore21SQLTransactionBackend16stateFunctionForENS_19SQLTransactionStateE" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16stateFunctionForENS_19SQLTransactionStateE">stateFunctionFor</dfn>(<a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a> <dfn class="local col1 decl" id="71state" title='state' data-type='WebCore::SQLTransactionState' data-ref="71state" data-ref-filename="71state">state</dfn>)</td></tr>
<tr><th id="403">403</th><td>{</td></tr>
<tr><th id="404">404</th><td>    <em>static</em> <em>const</em> <a class="typedef" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine{WebCore::SQLTransactionBackend}::StateFunction" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::StateFunction' data-type='void (WebCore::SQLTransactionBackend::*)()' data-ref="WebCore::SQLTransactionStateMachine{WebCore::SQLTransactionBackend}::StateFunction" data-ref-filename="WebCore..SQLTransactionStateMachine{WebCore..SQLTransactionBackend}..StateFunction">StateFunction</a> <dfn class="local col2 decl" id="72stateFunctions" title='stateFunctions' data-type='const WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::StateFunction [13]' data-ref="72stateFunctions" data-ref-filename="72stateFunctions">stateFunctions</dfn>[] = {</td></tr>
<tr><th id="405">405</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</a>,            <i>// 0. end</i></td></tr>
<tr><th id="406">406</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</a>,            <i>// 1. idle</i></td></tr>
<tr><th id="407">407</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend11acquireLockEv" title='WebCore::SQLTransactionBackend::acquireLock' data-ref="_ZN7WebCore21SQLTransactionBackend11acquireLockEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend11acquireLockEv">acquireLock</a>,                 <i>// 2.</i></td></tr>
<tr><th id="408">408</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend27openTransactionAndPreflightEv" title='WebCore::SQLTransactionBackend::openTransactionAndPreflight' data-ref="_ZN7WebCore21SQLTransactionBackend27openTransactionAndPreflightEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend27openTransactionAndPreflightEv">openTransactionAndPreflight</a>, <i>// 3.</i></td></tr>
<tr><th id="409">409</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend13runStatementsEv" title='WebCore::SQLTransactionBackend::runStatements' data-ref="_ZN7WebCore21SQLTransactionBackend13runStatementsEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend13runStatementsEv">runStatements</a>,               <i>// 4.</i></td></tr>
<tr><th id="410">410</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</a>,            <i>// 5. postflightAndCommit</i></td></tr>
<tr><th id="411">411</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend19cleanupAndTerminateEv" title='WebCore::SQLTransactionBackend::cleanupAndTerminate' data-ref="_ZN7WebCore21SQLTransactionBackend19cleanupAndTerminateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend19cleanupAndTerminateEv">cleanupAndTerminate</a>,         <i>// 6.</i></td></tr>
<tr><th id="412">412</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend36cleanupAfterTransactionErrorCallbackEv" title='WebCore::SQLTransactionBackend::cleanupAfterTransactionErrorCallback' data-ref="_ZN7WebCore21SQLTransactionBackend36cleanupAfterTransactionErrorCallbackEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend36cleanupAfterTransactionErrorCallbackEv">cleanupAfterTransactionErrorCallback</a>, <i>// 7.</i></td></tr>
<tr><th id="413">413</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</a>,            <i>// 8. deliverTransactionCallback</i></td></tr>
<tr><th id="414">414</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</a>,            <i>// 9. deliverTransactionErrorCallback</i></td></tr>
<tr><th id="415">415</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</a>,            <i>// 10. deliverStatementCallback</i></td></tr>
<tr><th id="416">416</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</a>,            <i>// 11. deliverQuotaIncreaseCallback</i></td></tr>
<tr><th id="417">417</th><td>        &amp;<a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</a>             <i>// 12. deliverSuccessCallback</i></td></tr>
<tr><th id="418">418</th><td>    };</td></tr>
<tr><th id="419">419</th><td></td></tr>
<tr><th id="420">420</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#347" title="do { if (!(sizeof(::WTF::ArrayLengthHelperFunction(stateFunctions)) == static_cast&lt;int&gt;(SQLTransactionState::NumberOfStates))) { WTFReportAssertionFailure(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, 420, __PRETTY_FUNCTION__, &quot;WTF_ARRAY_LENGTH(stateFunctions) == static_cast&lt;int&gt;(SQLTransactionState::NumberOfStates)&quot;); do { WTF::isIntegralOrPointerType(); compilerFenceForCrash(); WTFCrashWithInfo(420, &quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, __PRETTY_FUNCTION__, 664); } while (false); } } while (0)" data-ref="_M/ASSERT">ASSERT</a>(<a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/StdLibExtras.h.html#170" title="sizeof(::WTF::ArrayLengthHelperFunction(stateFunctions))" data-ref="_M/WTF_ARRAY_LENGTH">WTF_ARRAY_LENGTH</a>(<a class="local col2 ref" href="#72stateFunctions" title='stateFunctions' data-ref="72stateFunctions" data-ref-filename="72stateFunctions">stateFunctions</a>) == <b>static_cast</b>&lt;<em>int</em>&gt;(<a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::NumberOfStates" title='WebCore::SQLTransactionState::NumberOfStates' data-ref="WebCore::SQLTransactionState::NumberOfStates" data-ref-filename="WebCore..SQLTransactionState..NumberOfStates">NumberOfStates</a>));</td></tr>
<tr><th id="421">421</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#347" title="do { if (!(state &lt; SQLTransactionState::NumberOfStates)) { WTFReportAssertionFailure(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, 421, __PRETTY_FUNCTION__, &quot;state &lt; SQLTransactionState::NumberOfStates&quot;); do { WTF::isIntegralOrPointerType(); compilerFenceForCrash(); WTFCrashWithInfo(421, &quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, __PRETTY_FUNCTION__, 666); } while (false); } } while (0)" data-ref="_M/ASSERT">ASSERT</a>(<a class="local col1 ref" href="#71state" title='state' data-ref="71state" data-ref-filename="71state">state</a> &lt; <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::NumberOfStates" title='WebCore::SQLTransactionState::NumberOfStates' data-ref="WebCore::SQLTransactionState::NumberOfStates" data-ref-filename="WebCore..SQLTransactionState..NumberOfStates">NumberOfStates</a>);</td></tr>
<tr><th id="422">422</th><td></td></tr>
<tr><th id="423">423</th><td>    <b>return</b> <a class="local col2 ref" href="#72stateFunctions" title='stateFunctions' data-ref="72stateFunctions" data-ref-filename="72stateFunctions">stateFunctions</a>[<b>static_cast</b>&lt;<em>int</em>&gt;(<a class="local col1 ref" href="#71state" title='state' data-ref="71state" data-ref-filename="71state">state</a>)];</td></tr>
<tr><th id="424">424</th><td>}</td></tr>
<tr><th id="425">425</th><td></td></tr>
<tr><th id="426">426</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend34computeNextStateAndCleanupIfNeededEv" title='WebCore::SQLTransactionBackend::computeNextStateAndCleanupIfNeeded' data-ref="_ZN7WebCore21SQLTransactionBackend34computeNextStateAndCleanupIfNeededEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend34computeNextStateAndCleanupIfNeededEv">computeNextStateAndCleanupIfNeeded</dfn>()</td></tr>
<tr><th id="427">427</th><td>{</td></tr>
<tr><th id="428">428</th><td>    <i>// Only honor the requested state transition if we're not supposed to be</i></td></tr>
<tr><th id="429">429</th><td><i>    // cleaning up and shutting down:</i></td></tr>
<tr><th id="430">430</th><td>    <b>if</b> (<a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_database" title='WebCore::SQLTransaction::m_database' data-ref="WebCore::SQLTransaction::m_database" data-ref-filename="WebCore..SQLTransaction..m_database">m_database</a><a class="ref fn" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Ref.h.html#_ZNK3WTF3RefptEv" title='WTF::Ref::operator-&gt;' data-ref="_ZNK3WTF3RefptEv" data-ref-filename="_ZNK3WTF3RefptEv">-&gt;</a><a class="ref fn" href="Database.h.html#_ZNK7WebCore8Database6openedEv" title='WebCore::Database::opened' data-ref="_ZNK7WebCore8Database6openedEv" data-ref-filename="_ZNK7WebCore8Database6openedEv">opened</a>()) {</td></tr>
<tr><th id="431">431</th><td>        <a class="member fn" href="SQLTransactionStateMachine.h.html#_ZN7WebCore26SQLTransactionStateMachine24setStateToRequestedStateEv" title='WebCore::SQLTransactionStateMachine::setStateToRequestedState' data-ref="_ZN7WebCore26SQLTransactionStateMachine24setStateToRequestedStateEv" data-ref-filename="_ZN7WebCore26SQLTransactionStateMachine24setStateToRequestedStateEv">setStateToRequestedState</a>();</td></tr>
<tr><th id="432">432</th><td>        <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#347" title="do { if (!(m_nextState == SQLTransactionState::AcquireLock || m_nextState == SQLTransactionState::OpenTransactionAndPreflight || m_nextState == SQLTransactionState::RunStatements || m_nextState == SQLTransactionState::PostflightAndCommit || m_nextState == SQLTransactionState::CleanupAndTerminate || m_nextState == SQLTransactionState::CleanupAfterTransactionErrorCallback)) { WTFReportAssertionFailure(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, 437, __PRETTY_FUNCTION__, &quot;m_nextState == SQLTransactionState::AcquireLock || m_nextState == SQLTransactionState::OpenTransactionAndPreflight || m_nextState == SQLTransactionState::RunStatements || m_nextState == SQLTransactionState::PostflightAndCommit || m_nextState == SQLTransactionState::CleanupAndTerminate || m_nextState == SQLTransactionState::CleanupAfterTransactionErrorCallback&quot;); do { WTF::isIntegralOrPointerType(); compilerFenceForCrash(); WTFCrashWithInfo(437, &quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, __PRETTY_FUNCTION__, 668); } while (false); } } while (0)" data-ref="_M/ASSERT">ASSERT</a>(<a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a> == <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::AcquireLock" title='WebCore::SQLTransactionState::AcquireLock' data-ref="WebCore::SQLTransactionState::AcquireLock" data-ref-filename="WebCore..SQLTransactionState..AcquireLock">AcquireLock</a></td></tr>
<tr><th id="433">433</th><td>            || <a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a> == <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::OpenTransactionAndPreflight" title='WebCore::SQLTransactionState::OpenTransactionAndPreflight' data-ref="WebCore::SQLTransactionState::OpenTransactionAndPreflight" data-ref-filename="WebCore..SQLTransactionState..OpenTransactionAndPreflight">OpenTransactionAndPreflight</a></td></tr>
<tr><th id="434">434</th><td>            || <a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a> == <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::RunStatements" title='WebCore::SQLTransactionState::RunStatements' data-ref="WebCore::SQLTransactionState::RunStatements" data-ref-filename="WebCore..SQLTransactionState..RunStatements">RunStatements</a></td></tr>
<tr><th id="435">435</th><td>            || <a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a> == <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::PostflightAndCommit" title='WebCore::SQLTransactionState::PostflightAndCommit' data-ref="WebCore::SQLTransactionState::PostflightAndCommit" data-ref-filename="WebCore..SQLTransactionState..PostflightAndCommit">PostflightAndCommit</a></td></tr>
<tr><th id="436">436</th><td>            || <a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a> == <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::CleanupAndTerminate" title='WebCore::SQLTransactionState::CleanupAndTerminate' data-ref="WebCore::SQLTransactionState::CleanupAndTerminate" data-ref-filename="WebCore..SQLTransactionState..CleanupAndTerminate">CleanupAndTerminate</a></td></tr>
<tr><th id="437">437</th><td>            || <a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a> == <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::CleanupAfterTransactionErrorCallback" title='WebCore::SQLTransactionState::CleanupAfterTransactionErrorCallback' data-ref="WebCore::SQLTransactionState::CleanupAfterTransactionErrorCallback" data-ref-filename="WebCore..SQLTransactionState..CleanupAfterTransactionErrorCallback">CleanupAfterTransactionErrorCallback</a>);</td></tr>
<tr><th id="438">438</th><td></td></tr>
<tr><th id="439">439</th><td>        <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#489" title="WTFLog(&amp;LogStorageAPI, &quot;State %s\n&quot;, nameForSQLTransactionState(m_nextState))" data-ref="_M/LOG">LOG</a>(StorageAPI, <q>"State %s\n"</q>, <a class="ref fn" href="SQLTransactionStateMachine.cpp.html#_ZN7WebCore26nameForSQLTransactionStateENS_19SQLTransactionStateE" title='WebCore::nameForSQLTransactionState' data-ref="_ZN7WebCore26nameForSQLTransactionStateENS_19SQLTransactionStateE" data-ref-filename="_ZN7WebCore26nameForSQLTransactionStateENS_19SQLTransactionStateE">nameForSQLTransactionState</a>(<a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a>));</td></tr>
<tr><th id="440">440</th><td>        <b>return</b>;</td></tr>
<tr><th id="441">441</th><td>    }</td></tr>
<tr><th id="442">442</th><td></td></tr>
<tr><th id="443">443</th><td>    <i>// If we get here, then we should be shutting down. Do clean up if needed:</i></td></tr>
<tr><th id="444">444</th><td>    <b>if</b> (<a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a> == <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::End" title='WebCore::SQLTransactionState::End' data-ref="WebCore::SQLTransactionState::End" data-ref-filename="WebCore..SQLTransactionState..End">End</a>)</td></tr>
<tr><th id="445">445</th><td>        <b>return</b>;</td></tr>
<tr><th id="446">446</th><td>    <a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_nextState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_nextState' data-ref="WebCore::SQLTransactionStateMachine::m_nextState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_nextState">m_nextState</a> = <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::End" title='WebCore::SQLTransactionState::End' data-ref="WebCore::SQLTransactionState::End" data-ref-filename="WebCore..SQLTransactionState..End">End</a>;</td></tr>
<tr><th id="447">447</th><td></td></tr>
<tr><th id="448">448</th><td>    <i>// If the database was stopped, don't do anything and cancel queued work</i></td></tr>
<tr><th id="449">449</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#489" title="WTFLog(&amp;LogStorageAPI, &quot;Database was stopped or interrupted - cancelling work for this transaction&quot;)" data-ref="_M/LOG">LOG</a>(StorageAPI, <q>"Database was stopped or interrupted - cancelling work for this transaction"</q>);</td></tr>
<tr><th id="450">450</th><td></td></tr>
<tr><th id="451">451</th><td>    <i>// The current SQLite transaction should be stopped, as well</i></td></tr>
<tr><th id="452">452</th><td>    <b>if</b> (<span class='ref fn fake' title='std::__1::unique_ptr::operator bool' data-ref="_ZNKSt3__110unique_ptrcvbEv" data-ref-filename="_ZNKSt3__110unique_ptrcvbEv"></span><a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_sqliteTransaction" title='WebCore::SQLTransaction::m_sqliteTransaction' data-ref="WebCore::SQLTransaction::m_sqliteTransaction" data-ref-filename="WebCore..SQLTransaction..m_sqliteTransaction">m_sqliteTransaction</a>) {</td></tr>
<tr><th id="453">453</th><td>        <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_sqliteTransaction" title='WebCore::SQLTransaction::m_sqliteTransaction' data-ref="WebCore::SQLTransaction::m_sqliteTransaction" data-ref-filename="WebCore..SQLTransaction..m_sqliteTransaction">m_sqliteTransaction</a><span class='ref fn' title='std::__1::unique_ptr::operator-&gt;' data-ref="_ZNKSt3__110unique_ptrptEv" data-ref-filename="_ZNKSt3__110unique_ptrptEv">-&gt;</span><a class="ref fn" href="../../platform/sql/SQLiteTransaction.h.html#_ZN7WebCore17SQLiteTransaction4stopEv" title='WebCore::SQLiteTransaction::stop' data-ref="_ZN7WebCore17SQLiteTransaction4stopEv" data-ref-filename="_ZN7WebCore17SQLiteTransaction4stopEv">stop</a>();</td></tr>
<tr><th id="454">454</th><td>        <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_sqliteTransaction" title='WebCore::SQLTransaction::m_sqliteTransaction' data-ref="WebCore::SQLTransaction::m_sqliteTransaction" data-ref-filename="WebCore..SQLTransaction..m_sqliteTransaction">m_sqliteTransaction</a> <span class='ref fn' title='std::__1::unique_ptr::operator=' data-ref="_ZNSt3__110unique_ptraSEDn" data-ref-filename="_ZNSt3__110unique_ptraSEDn">=</span> <b>nullptr</b>;</td></tr>
<tr><th id="455">455</th><td>    }</td></tr>
<tr><th id="456">456</th><td></td></tr>
<tr><th id="457">457</th><td>    <i>// Terminate the frontend state machine. This also gets the frontend to</i></td></tr>
<tr><th id="458">458</th><td><i>    // call computeNextStateAndCleanupIfNeeded() and clear its wrappers</i></td></tr>
<tr><th id="459">459</th><td><i>    // if needed.</i></td></tr>
<tr><th id="460">460</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.cpp.html#_ZN7WebCore14SQLTransaction21requestTransitToStateENS_19SQLTransactionStateE" title='WebCore::SQLTransaction::requestTransitToState' data-ref="_ZN7WebCore14SQLTransaction21requestTransitToStateENS_19SQLTransactionStateE" data-ref-filename="_ZN7WebCore14SQLTransaction21requestTransitToStateENS_19SQLTransactionStateE">requestTransitToState</a>(<a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::End" title='WebCore::SQLTransactionState::End' data-ref="WebCore::SQLTransactionState::End" data-ref-filename="WebCore..SQLTransactionState..End">End</a>);</td></tr>
<tr><th id="461">461</th><td></td></tr>
<tr><th id="462">462</th><td>    <i>// Redirect to the end state to abort, clean up, and end the transaction.</i></td></tr>
<tr><th id="463">463</th><td>    <a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend9doCleanupEv" title='WebCore::SQLTransactionBackend::doCleanup' data-ref="_ZN7WebCore21SQLTransactionBackend9doCleanupEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend9doCleanupEv">doCleanup</a>();</td></tr>
<tr><th id="464">464</th><td>}</td></tr>
<tr><th id="465">465</th><td></td></tr>
<tr><th id="466">466</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend34notifyDatabaseThreadIsShuttingDownEv" title='WebCore::SQLTransactionBackend::notifyDatabaseThreadIsShuttingDown' data-ref="_ZN7WebCore21SQLTransactionBackend34notifyDatabaseThreadIsShuttingDownEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend34notifyDatabaseThreadIsShuttingDownEv">notifyDatabaseThreadIsShuttingDown</dfn>()</td></tr>
<tr><th id="467">467</th><td>{</td></tr>
<tr><th id="468">468</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#347" title="do { if (!(m_frontend.database().databaseThread().getThread() == &amp;Thread::current())) { WTFReportAssertionFailure(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, 468, __PRETTY_FUNCTION__, &quot;m_frontend.database().databaseThread().getThread() == &amp;Thread::current()&quot;); do { WTF::isIntegralOrPointerType(); compilerFenceForCrash(); WTFCrashWithInfo(468, &quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, __PRETTY_FUNCTION__, 670); } while (false); } } while (0)" data-ref="_M/ASSERT">ASSERT</a>(<a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.h.html#_ZN7WebCore14SQLTransaction8databaseEv" title='WebCore::SQLTransaction::database' data-ref="_ZN7WebCore14SQLTransaction8databaseEv" data-ref-filename="_ZN7WebCore14SQLTransaction8databaseEv">database</a>().<a class="ref fn" href="Database.h.html#_ZN7WebCore8Database14databaseThreadEv" title='WebCore::Database::databaseThread' data-ref="_ZN7WebCore8Database14databaseThreadEv" data-ref-filename="_ZN7WebCore8Database14databaseThreadEv">databaseThread</a>().<a class="ref fn" href="DatabaseThread.h.html#_ZN7WebCore14DatabaseThread9getThreadEv" title='WebCore::DatabaseThread::getThread' data-ref="_ZN7WebCore14DatabaseThread9getThreadEv" data-ref-filename="_ZN7WebCore14DatabaseThread9getThreadEv">getThread</a>() == &amp;<a class="type" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Threading.h.html#WTF::Thread" title='WTF::Thread' data-ref="WTF::Thread" data-ref-filename="WTF..Thread">Thread</a>::<a class="ref fn" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Threading.h.html#_ZN3WTF6Thread7currentEv" title='WTF::Thread::current' data-ref="_ZN3WTF6Thread7currentEv" data-ref-filename="_ZN3WTF6Thread7currentEv">current</a>());</td></tr>
<tr><th id="469">469</th><td></td></tr>
<tr><th id="470">470</th><td>    <i>// If the transaction is in progress, we should roll it back here, since this</i></td></tr>
<tr><th id="471">471</th><td><i>    // is our last opportunity to do something related to this transaction on the</i></td></tr>
<tr><th id="472">472</th><td><i>    // DB thread. Amongst other work, doCleanup() will clear m_sqliteTransaction</i></td></tr>
<tr><th id="473">473</th><td><i>    // which invokes SQLiteTransaction's destructor, which will do the roll back</i></td></tr>
<tr><th id="474">474</th><td><i>    // if necessary.</i></td></tr>
<tr><th id="475">475</th><td>    <a class="member fn" href="#_ZN7WebCore21SQLTransactionBackend9doCleanupEv" title='WebCore::SQLTransactionBackend::doCleanup' data-ref="_ZN7WebCore21SQLTransactionBackend9doCleanupEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend9doCleanupEv">doCleanup</a>();</td></tr>
<tr><th id="476">476</th><td>}</td></tr>
<tr><th id="477">477</th><td></td></tr>
<tr><th id="478">478</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend11acquireLockEv" title='WebCore::SQLTransactionBackend::acquireLock' data-ref="_ZN7WebCore21SQLTransactionBackend11acquireLockEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend11acquireLockEv">acquireLock</dfn>()</td></tr>
<tr><th id="479">479</th><td>{</td></tr>
<tr><th id="480">480</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.cpp.html#_ZN7WebCore14SQLTransaction11acquireLockEv" title='WebCore::SQLTransaction::acquireLock' data-ref="_ZN7WebCore14SQLTransaction11acquireLockEv" data-ref-filename="_ZN7WebCore14SQLTransaction11acquireLockEv">acquireLock</a>();</td></tr>
<tr><th id="481">481</th><td>}</td></tr>
<tr><th id="482">482</th><td></td></tr>
<tr><th id="483">483</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend27openTransactionAndPreflightEv" title='WebCore::SQLTransactionBackend::openTransactionAndPreflight' data-ref="_ZN7WebCore21SQLTransactionBackend27openTransactionAndPreflightEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend27openTransactionAndPreflightEv">openTransactionAndPreflight</dfn>()</td></tr>
<tr><th id="484">484</th><td>{</td></tr>
<tr><th id="485">485</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.cpp.html#_ZN7WebCore14SQLTransaction27openTransactionAndPreflightEv" title='WebCore::SQLTransaction::openTransactionAndPreflight' data-ref="_ZN7WebCore14SQLTransaction27openTransactionAndPreflightEv" data-ref-filename="_ZN7WebCore14SQLTransaction27openTransactionAndPreflightEv">openTransactionAndPreflight</a>();</td></tr>
<tr><th id="486">486</th><td>}</td></tr>
<tr><th id="487">487</th><td></td></tr>
<tr><th id="488">488</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend13runStatementsEv" title='WebCore::SQLTransactionBackend::runStatements' data-ref="_ZN7WebCore21SQLTransactionBackend13runStatementsEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend13runStatementsEv">runStatements</dfn>()</td></tr>
<tr><th id="489">489</th><td>{</td></tr>
<tr><th id="490">490</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.cpp.html#_ZN7WebCore14SQLTransaction13runStatementsEv" title='WebCore::SQLTransaction::runStatements' data-ref="_ZN7WebCore14SQLTransaction13runStatementsEv" data-ref-filename="_ZN7WebCore14SQLTransaction13runStatementsEv">runStatements</a>();</td></tr>
<tr><th id="491">491</th><td>}</td></tr>
<tr><th id="492">492</th><td></td></tr>
<tr><th id="493">493</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend19cleanupAndTerminateEv" title='WebCore::SQLTransactionBackend::cleanupAndTerminate' data-ref="_ZN7WebCore21SQLTransactionBackend19cleanupAndTerminateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend19cleanupAndTerminateEv">cleanupAndTerminate</dfn>()</td></tr>
<tr><th id="494">494</th><td>{</td></tr>
<tr><th id="495">495</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.cpp.html#_ZN7WebCore14SQLTransaction19cleanupAndTerminateEv" title='WebCore::SQLTransaction::cleanupAndTerminate' data-ref="_ZN7WebCore14SQLTransaction19cleanupAndTerminateEv" data-ref-filename="_ZN7WebCore14SQLTransaction19cleanupAndTerminateEv">cleanupAndTerminate</a>();</td></tr>
<tr><th id="496">496</th><td>}</td></tr>
<tr><th id="497">497</th><td></td></tr>
<tr><th id="498">498</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend36cleanupAfterTransactionErrorCallbackEv" title='WebCore::SQLTransactionBackend::cleanupAfterTransactionErrorCallback' data-ref="_ZN7WebCore21SQLTransactionBackend36cleanupAfterTransactionErrorCallbackEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend36cleanupAfterTransactionErrorCallbackEv">cleanupAfterTransactionErrorCallback</dfn>()</td></tr>
<tr><th id="499">499</th><td>{</td></tr>
<tr><th id="500">500</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref fn" href="SQLTransaction.cpp.html#_ZN7WebCore14SQLTransaction36cleanupAfterTransactionErrorCallbackEv" title='WebCore::SQLTransaction::cleanupAfterTransactionErrorCallback' data-ref="_ZN7WebCore14SQLTransaction36cleanupAfterTransactionErrorCallbackEv" data-ref-filename="_ZN7WebCore14SQLTransaction36cleanupAfterTransactionErrorCallbackEv">cleanupAfterTransactionErrorCallback</a>();</td></tr>
<tr><th id="501">501</th><td>}</td></tr>
<tr><th id="502">502</th><td></td></tr>
<tr><th id="503">503</th><td><i>// requestTransitToState() can be called from the frontend. Hence, it should</i></td></tr>
<tr><th id="504">504</th><td><i>// NOT be modifying SQLTransactionBackend in general. The only safe field to</i></td></tr>
<tr><th id="505">505</th><td><i>// modify is m_requestedState which is meant for this purpose.</i></td></tr>
<tr><th id="506">506</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend21requestTransitToStateENS_19SQLTransactionStateE" title='WebCore::SQLTransactionBackend::requestTransitToState' data-ref="_ZN7WebCore21SQLTransactionBackend21requestTransitToStateENS_19SQLTransactionStateE" data-ref-filename="_ZN7WebCore21SQLTransactionBackend21requestTransitToStateENS_19SQLTransactionStateE">requestTransitToState</dfn>(<a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a> <dfn class="local col3 decl" id="73nextState" title='nextState' data-type='WebCore::SQLTransactionState' data-ref="73nextState" data-ref-filename="73nextState">nextState</dfn>)</td></tr>
<tr><th id="507">507</th><td>{</td></tr>
<tr><th id="508">508</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#489" title="WTFLog(&amp;LogStorageAPI, &quot;Scheduling %s for transaction %p\n&quot;, nameForSQLTransactionState(nextState), this)" data-ref="_M/LOG">LOG</a>(StorageAPI, <q>"Scheduling %s for transaction %p\n"</q>, <a class="ref fn" href="SQLTransactionStateMachine.cpp.html#_ZN7WebCore26nameForSQLTransactionStateENS_19SQLTransactionStateE" title='WebCore::nameForSQLTransactionState' data-ref="_ZN7WebCore26nameForSQLTransactionStateENS_19SQLTransactionStateE" data-ref-filename="_ZN7WebCore26nameForSQLTransactionStateENS_19SQLTransactionStateE">nameForSQLTransactionState</a>(<a class="local col3 ref" href="#73nextState" title='nextState' data-ref="73nextState" data-ref-filename="73nextState">nextState</a>), <b>this</b>);</td></tr>
<tr><th id="509">509</th><td>    <a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_requestedState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_requestedState' data-ref="WebCore::SQLTransactionStateMachine::m_requestedState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_requestedState">m_requestedState</a> = <a class="local col3 ref" href="#73nextState" title='nextState' data-ref="73nextState" data-ref-filename="73nextState">nextState</a>;</td></tr>
<tr><th id="510">510</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#347" title="do { if (!(m_requestedState != SQLTransactionState::End)) { WTFReportAssertionFailure(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, 510, __PRETTY_FUNCTION__, &quot;m_requestedState != SQLTransactionState::End&quot;); do { WTF::isIntegralOrPointerType(); compilerFenceForCrash(); WTFCrashWithInfo(510, &quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, __PRETTY_FUNCTION__, 672); } while (false); } } while (0)" data-ref="_M/ASSERT">ASSERT</a>(<a class="member field" href="SQLTransactionStateMachine.h.html#WebCore::SQLTransactionStateMachine::m_requestedState" title='WebCore::SQLTransactionStateMachine&lt;WebCore::SQLTransactionBackend&gt;::m_requestedState' data-ref="WebCore::SQLTransactionStateMachine::m_requestedState" data-ref-filename="WebCore..SQLTransactionStateMachine..m_requestedState">m_requestedState</a> != <a class="type" href="SQLTransactionState.h.html#WebCore::SQLTransactionState" title='WebCore::SQLTransactionState' data-ref="WebCore::SQLTransactionState" data-ref-filename="WebCore..SQLTransactionState">SQLTransactionState</a>::<a class="enum" href="SQLTransactionState.h.html#WebCore::SQLTransactionState::End" title='WebCore::SQLTransactionState::End' data-ref="WebCore::SQLTransactionState::End" data-ref-filename="WebCore..SQLTransactionState..End">End</a>);</td></tr>
<tr><th id="511">511</th><td>    <a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a>.<a class="ref field" href="SQLTransaction.h.html#WebCore::SQLTransaction::m_database" title='WebCore::SQLTransaction::m_database' data-ref="WebCore::SQLTransaction::m_database" data-ref-filename="WebCore..SQLTransaction..m_database">m_database</a><a class="ref fn" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Ref.h.html#_ZNK3WTF3RefptEv" title='WTF::Ref::operator-&gt;' data-ref="_ZNK3WTF3RefptEv" data-ref-filename="_ZNK3WTF3RefptEv">-&gt;</a><a class="ref fn" href="Database.h.html#_ZN7WebCore8Database23scheduleTransactionStepERNS_14SQLTransactionE" title='WebCore::Database::scheduleTransactionStep' data-ref="_ZN7WebCore8Database23scheduleTransactionStepERNS_14SQLTransactionE" data-ref-filename="_ZN7WebCore8Database23scheduleTransactionStepERNS_14SQLTransactionE">scheduleTransactionStep</a>(<span class='refarg'><a class="member field" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend::m_frontend" title='WebCore::SQLTransactionBackend::m_frontend' data-ref="WebCore::SQLTransactionBackend::m_frontend" data-ref-filename="WebCore..SQLTransactionBackend..m_frontend">m_frontend</a></span>);</td></tr>
<tr><th id="512">512</th><td>}</td></tr>
<tr><th id="513">513</th><td></td></tr>
<tr><th id="514">514</th><td><i>// This state function is used as a stub function to plug unimplemented states</i></td></tr>
<tr><th id="515">515</th><td><i>// in the state dispatch table. They are unimplemented because they should</i></td></tr>
<tr><th id="516">516</th><td><i>// never be reached in the course of correct execution.</i></td></tr>
<tr><th id="517">517</th><td><em>void</em> <a class="type" href="SQLTransactionBackend.h.html#WebCore::SQLTransactionBackend" title='WebCore::SQLTransactionBackend' data-ref="WebCore::SQLTransactionBackend" data-ref-filename="WebCore..SQLTransactionBackend">SQLTransactionBackend</a>::<dfn class="decl def fn" id="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" title='WebCore::SQLTransactionBackend::unreachableState' data-ref="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv" data-ref-filename="_ZN7WebCore21SQLTransactionBackend16unreachableStateEv">unreachableState</dfn>()</td></tr>
<tr><th id="518">518</th><td>{</td></tr>
<tr><th id="519">519</th><td>    <a class="macro" href="../../../../WebKitBuild/Debug/usr/local/include/wtf/Assertions.h.html#368" title="do { WTFReportAssertionFailure(&quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, 519, __PRETTY_FUNCTION__, 0); do { WTF::isIntegralOrPointerType(); compilerFenceForCrash(); WTFCrashWithInfo(519, &quot;/Volumes/ExternalSSD/Projects/webkit/WebKit/Source/WebCore/Modules/webdatabase/SQLTransactionBackend.cpp&quot;, __PRETTY_FUNCTION__, 674); } while (false); } while (0)" data-ref="_M/ASSERT_NOT_REACHED">ASSERT_NOT_REACHED</a>();</td></tr>
<tr><th id="520">520</th><td>}</td></tr>
<tr><th id="521">521</th><td></td></tr>
<tr><th id="522">522</th><td>} <i>// namespace WebCore</i></td></tr>
<tr><th id="523">523</th><td></td></tr>
</table><hr/><p id='footer'>
Generated while processing <a href='../../../../WebKitBuild/Debug/DerivedSources/WebCore/unified-sources/UnifiedSource62.cpp.html'>webkit/WebKitBuild/Debug/DerivedSources/WebCore/unified-sources/UnifiedSource62.cpp</a><br/>Generated on <em>2021-Jul-06</em> from project webkit<br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
